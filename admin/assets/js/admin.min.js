!function(){"use strict";var t={};t.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),t.get=function O(t,e,i){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,e);if(void 0===s){var n=Object.getPrototypeOf(t);return null===n?void 0:O(n,e,i)}if("value"in s)return s.value;var a=s.get;if(void 0!==a)return a.call(i)},t.inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},t.possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};var e=jQuery,i=function(){function e(){t.classCallCheck(this,e)}return t.createClass(e,null,[{key:"isEnabled",value:function(){return this._enabled=this._enabled||decomGifts.debug||!1}},{key:"info",value:function(t){this.isEnabled()&&console.info(t)}},{key:"log",value:function(t){this.isEnabled()&&console.log(t)}},{key:"error",value:function(t){this.isEnabled()&&console.error(t)}}]),e}(),s=function(){function s(){var n=arguments.length<=0||void 0===arguments[0]?"body":arguments[0],a=arguments[1],r=arguments[2],o=arguments[3],c=arguments[4],l=arguments.length<=5||void 0===arguments[5]?!0:arguments[5];t.classCallCheck(this,s),this._parent=n,this._selector=a,this._event=r,this._object=o,this._method=c,this._callback=function(t){l&&(t.preventDefault(),t.stopPropagation()),o[c].apply(o,arguments)},e(this._parent).on(this._event,this._selector,this._callback),i.info("Bound - parent: "+this._parent+", event: "+this._event+", selector: "+this._selector+", object: "+o+", method: "+c),i.log("Parent:"),i.log(this._parent),i.log("Object:"),i.log(o)}return t.createClass(s,[{key:"unbind",value:function(){e(this._parent).off(this._event,this._selector,this._callback),i.info("Unbound - parent: "+this._parent+", event: "+this._event+", selector: "+this._selector),i.log("Parent:"),i.log(this._parent)}},{key:"selector",value:function(){return this._selector}}]),s}(),n=function(){function e(i){t.classCallCheck(this,e),this._data=i,this._bound=new Array,this._bindings=new Array,this.init()}return t.createClass(e,[{key:"init",value:function(){this.bind()}},{key:"bind",value:function(){var t=this;this._bindings.forEach(function(e,i,n){t._bound.push(new s(t._element,e.selector,e.event,e.object,e.method,e.preventDefault||!0))})}}]),e}(),a=function(){function e(){t.classCallCheck(this,e)}return t.createClass(e,null,[{key:"loadTranslations",value:function(){this._translations=this._translations||decomGifts.screen.translations||new Object}},{key:"text",value:function(t){return this.loadTranslations(),this._translations[t]||t}}]),e}(),r=function(){function n(e){var i=this,s=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];if(t.classCallCheck(this,n),this._id=e,this._conditions=s,this._type=s.type||null,this._currentStep=0,this._subcriteria=new Map,this._subcriteriaLastIndex=-1,this._conditions.subcriteria){var o=this._conditions.subcriteria[this._conditions.subcriteria.length-1].id;this._subcriteriaLastIndex=parseInt(o.substring(o.lastIndexOf("-")+1))}this._logic=s.logic||null,this._scrollTo=s.scrollTo||!1,this._checks_out=!1,this._$element=null,this._bound=new Array,this._steps=new Array,this._sourceCriteria=r,this._selectTypeElementId="dgfw_criteria_choose_type_"+this._id,this._$selectTypeElement=null,this._elementData={tag:"div",id:"dgfw_criteria_"+this._id,classes:["dgfw-criteria"]},this._descriptionData={tag:"div",id:"dgfw_criteria_description_"+this._id,classes:["dgfw-criteria-description"]},this._types=new Map([["amounts",a.text("Amounts")],["items",a.text("Items")],["products",a.text("Products")],["product_categories",a.text("Product Categories")],["periods",a.text("Time Period")],["users",a.text("Users")],["user_roles",a.text("User Roles")]]),this._chooseTypeData={tag:"div",id:"dgfw_choose_type_wrap_"+this._id,classes:["dgfw-choose-type-container"],children:[{tag:"select",id:this._selectTypeElementId,classes:["dgfw-select-type"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][type]"},children:[]}]},this._types.forEach(function(t,e,s){var n={tag:"option",attributes:{value:e},text:t};i._type===e&&(n.attributes.selected="selected"),i._chooseTypeData.children[0].children.push(n)}),this._stepListContainerData={tag:"div",id:"dgfw_step_list_container_"+this._id,classes:["dgfw-criteria-step-list-container"],children:[]},this._stepListData={tag:"ul",id:"dgfw_step_list_"+this._id,classes:["dgfw-criteria-step-list","current-step-0"],children:[]},this._navigationData={tag:"div",id:"dgfw_criteria_nav_"+this._id,classes:["dgfw-criteria-nav"],children:[{tag:"button",id:"dgfw_prev_step_"+this._id,classes:["button","dgfw-button","dgfw-prev-step","dashicons-before","dashicons-arrow-left-alt"],text:a.text("Back"),attributes:{disabled:"disabled"}},{tag:"button",id:"dgfw_next_step_"+this._id,classes:["button","dgfw-button","dgfw-next-step","dashicons-after","dashicons-arrow-right-alt"],text:a.text("Next")}]},this._removeData={tag:"button",id:"dgfw_criteria_remove_"+this._id,classes:["dgfw-criteria-remove","dgfw-button","dashicons-before","dashicons-no"],text:a.text("Remove")};var c={tag:"button",id:"dgfw_add_and_"+this._id,classes:["button","dgfw-button","dgfw-add-and","dashicons-before","dashicons-warning"],text:a.text("AND")},l={tag:"button",id:"dgfw_add_or_"+this._id,classes:["button","dgfw-button","dgfw-add-or","dashicons-before","dashicons-editor-help"],text:a.text("OR")};this._andOrData={tag:"div",id:"dgfw_criteria_add_subcriteria_"+this._id,classes:["dgfw-subcriteria-add"],children:[]},this._logic?"OR"===this._logic?this._andOrData.children.push(c):this._andOrData.children.push(l):this._conditions.subcriteria&&this._conditions.subcriteria.length?"OR"===this._conditions.subcriteria[0].logic?this._andOrData.children.push(l):this._andOrData.children.push(c):this._andOrData.children=[c,l],this._chooseTypeData.children.push({method:"chooseType",description:a.text("Choose condition type:"),elements:[{tag:"select",id:this._selectTypeElementId,classes:["dgfw-select-type"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][type]"},children:[]}]}),this._bindings=[{selector:"#dgfw_next_step_"+this._id,event:"click",object:this,method:"showNextStep"},{selector:"#dgfw_prev_step_"+this._id,event:"click",object:this,method:"showPrevStep"},{selector:"#dgfw_add_and_"+this._id,event:"click",object:this,method:"addSubcriteriaAnd"},{selector:"#dgfw_add_or_"+this._id,event:"click",object:this,method:"addSubcriteriaOr"},{selector:"#dgfw_criteria_remove_"+this._id,event:"click",object:this,method:"removeCriteria"},{selector:"#dgfw_criteria_remove_"+this._id,event:"mouseover",object:this,method:"addHighlight"},{selector:"#dgfw_criteria_remove_"+this._id,event:"mouseout",object:this,method:"removeHighlight"}],this.init()}return t.createClass(n,[{key:"init",value:function(){this.hideNavigation(),this._lastStep=this._steps.length-1,this._bindings.push({selector:"#"+this._selectTypeElementId,event:"change",object:this,method:"changeType"}),this.bind(),this._steps.length>1&&this.showNavigation()}},{key:"takeOverFromSource",value:function(){var t=this;this._currentStep=this._sourceCriteria._currentStep,this._subcriteria=this._sourceCriteria._subcriteria,this._subcriteriaLastIndex=this._sourceCriteria._subcriteriaLastIndex,this._logic=this._sourceCriteria._logic,this._checksOut=this._sourceCriteria._checksOut,this._$element=this._sourceCriteria._$element,this._$description=this._sourceCriteria._$description,this._$stepListContainer=this._sourceCriteria._$stepListContainer,this._sourceCriteria._$stepList.attr("id",this._sourceCriteria._$stepList.attr("id")+"_old"),this._$stepList=this.createAndAppendChild(this._$stepListContainer,this._stepListData),this._$navigation=this._sourceCriteria._$navigation,this._$andOr=this._sourceCriteria._$andOr,this._steps=this._sourceCriteria._steps,this._selectTypeElementId=this._sourceCriteria._selectTypeElementId,this._$selectTypeElement=this._sourceCriteria._$selectTypeElement,this._$removeButton=this._sourceCriteria._$removeButton,this._sourceCriteria._bound.forEach(function(t,e,i){t.unbind()}),this._subcriteria.forEach(function(e,i,n){t._bound.push(new s(t._$element,e.elementSelector(),e.changeTypeEvent(),t,"changeCriteriaType")),t._bound.push(new s(t._$element,e.elementSelector(),e.removeEvent(),t,"removeSubcriteria"))}),this._currentStep=0}},{key:"createElement",value:function(){var t=this;this._$element=e(document.createElement(this._elementData.tag)),this._$element.attr("id",this._elementData.id),this._$element.addClass(this._elementData.classes.join(" ")),this._scrollTo&&this._$element.addClass("invisible"),this._elementData.children&&this._elementData.children.forEach(function(e,i,s){t.createAndAppendChild(t._$element,e)}),this._$description=this.createAndAppendChild(this._$element,this._descriptionData),this.createAndAppendChild(this._$element,this._chooseTypeData),this._$stepListContainer=this.createAndAppendChild(this._$element,this._stepListContainerData),this._$stepList=this.createAndAppendChild(this._$stepListContainer,this._stepListData),this._$navigation=this.createAndAppendChild(this._$element,this._navigationData),this._$removeButton=this.createAndAppendChild(this._$element,this._removeData),this._$andOr=this.createAndAppendChild(this._$element,this._andOrData),this.setElementDescription(a.text(this._logic||"First condition")),this._$element.addClass(this._logic?this._logic.toLowerCase():"first"),this._logic&&this.createAndAppendChild(this._$element,this.logicElement()),this.createAndAppendChild(this._$element,this.idElement()),this._scrollTo&&setTimeout(function(){t._$element.removeClass("invisible");var i=t._$element.offset().top;e("html, body").animate({scrollTop:i-100},1e3)},10)}},{key:"logicElement",value:function(){return{tag:"input",id:"dgfw_criteria_logic_"+this._id,attributes:{type:"hidden",name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][logic]",value:this._logic}}}},{key:"idElement",value:function(){return{tag:"input",id:"dgfw_criteria_id_"+this._id,attributes:{type:"hidden",name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][id]",value:this._id}}}},{key:"createAndAppendChild",value:function(t,i){var s=this,n=e(document.createElement(i.tag));if(n.attr("id",i.id),i.classes&&n.addClass(i.classes.join(" ")),i.attributes)for(var a in i.attributes)n.attr(a,i.attributes[a]);return i.text&&n.text(i.text),t.append(n),i.children&&i.children.forEach(function(t,e,i){s.createAndAppendChild(n,t)}),n}},{key:"bind",value:function(){var t=this;this._bindings.forEach(function(e,i,n){t._bound.push(new s(t._$element,e.selector,e.event,e.object,e.method))})}},{key:"incrementStep",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0];this._currentStep+=t,this._currentStep>this._lastStep&&(this._currentStep=this._lastStep),this._$stepList.find(".step-"+(this._currentStep-1)).removeClass("step-current").addClass("step-prev"),this._$stepList.find(".step-"+this._currentStep).addClass("step-current")}},{key:"decrementStep",value:function(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0];this._currentStep-=t,this._currentStep<0&&(this._currentStep=0),this._$stepList.find(".step-"+(this._currentStep+1)).removeClass("step-current"),this._$stepList.find(".step-"+this._currentStep).removeClass("step-prev").addClass("step-current")}},{key:"showNextStep",value:function(){this.incrementStep(),i.info("next, to step:"+this._currentStep),this.currentStep()}},{key:"showPrevStep",value:function(){this.decrementStep(),i.info("prev, to step:"+this._currentStep),this.currentStep()}},{key:"currentStep",value:function(){if(this.readjustSize(),this._steps.length>1){var t=0===this._currentStep;this._$navigation.find("button.dgfw-prev-step").text(this.prevStepButtonText()).prop("disabled",t);var e=this._currentStep===this._lastStep;this._$navigation.find("button.dgfw-next-step").text(this.nextStepButtonText()).prop("disabled",e)}this._steps[this._currentStep].method&&this[this._steps[this._currentStep].method]()}},{key:"readjustSize",value:function(){this._$stepListContainer.height(this._$stepList.find("li.step-"+this._currentStep+" > .dgfw-criteria-step-wrapper").height()+70)}},{key:"id",value:function(){return this._id}},{key:"element",value:function(){return this._$element}},{key:"conditions",value:function(){return this._conditions}},{key:"elementSelector",value:function(){return"#"+this._elementData.id}},{key:"changeTypeEvent",value:function(){return"DGFW.CriteriaChangeType_"+this._id}},{key:"removeEvent",value:function(){return"DGFW.CriteriaRemove_"+this._id}},{key:"setElementDescription",value:function(t){this._$description.text(t)}},{key:"description",value:function r(){var r=this._logic?a.text(this._logic):"";return r+=" "+this.generateDescription()}},{key:"generateDescription",value:function(){return this._type}},{key:"addSubcriteriaAnd",value:function(){this.addSubcriteria("AND"),this._$andOr.find("button.dgfw-add-or").hide()}},{key:"addSubcriteriaOr",value:function(){this.addSubcriteria("OR"),this._$andOr.find("button.dgfw-add-and").hide()}},{key:"addSubcriteria",value:function(t){var e=this._id+"-subcriteria-"+this.newSubcriteriaIndex(),i=E.createAndScrollTo(e,"amounts",{logic:t});this._subcriteria.set(e,i),this._$element.hasClass("first")&&this._$element.addClass(t.toLowerCase()),this.appendSubcriteriaElement(i.element()),this._bound.push(new s(this._$element,i.elementSelector(),i.changeTypeEvent(),this,"changeCriteriaType")),this._bound.push(new s(this._$element,i.elementSelector(),i.removeEvent(),this,"removeSubcriteria"))}},{key:"newSubcriteriaIndex",value:function(){return++this._subcriteriaLastIndex}},{key:"appendSubcriteriaElement",value:function(t){this._$andOr.before(t)}},{key:"chooseType",value:function(){i.info("choose type"),i.log(this),this._$navigation.find(".dgfw-prev-step").attr("disabled",!0)}},{key:"changeType",value:function(){this._$selectTypeElement=this._$selectTypeElement||e(document.getElementById(this._selectTypeElementId)),this._type!==this._$selectTypeElement.val()&&(this._$element.trigger(this.changeTypeEvent(),[this._id.toString(),this._$selectTypeElement.val()]),i.info("change type to: "+this._$selectTypeElement.val()),i.log(this))}},{key:"changeCriteriaType",value:function(t,e,i){this._subcriteria.set(e,new E.createFrom(this._subcriteria.get(e),i))}},{key:"showType",value:function(){i.info("show type: "+this._type),i.log(this)}},{key:"stepElementsExist",value:function(t){return this._sourceCriteria&&this._sourceCriteria._steps[t]&&this._sourceCriteria._steps[t].elements}},{key:"removeStepElements",value:function(t){var s=this;this._sourceCriteria._steps[t].elements.forEach(function(n,a,r){i.info("Removed: "+n.id),e(document.getElementById("dgfw_criteria_"+s._sourceCriteria.id()+"_step_"+t)).fadeOut().remove()})}},{key:"showNavigation",value:function(){this._$navigation.removeClass("invisible").find("button").prop("disabled",!1);var t=0===this._currentStep;this._$navigation.find("button.dgfw-prev-step").text(this.prevStepButtonText()).prop("disabled",t);var e=this._currentStep===this._lastStep;this._$navigation.find("button.dgfw-next-step").text(this.nextStepButtonText()).prop("disabled",e)}},{key:"hideNavigation",value:function(){this._$navigation.addClass("invisible").find("button").prop("disabled",!0)}},{key:"showCriteria",value:function(){var t=this;if(this._sourceCriteria||this.createElement(),this._steps.forEach(function(e,i,s){i<t._currentStep||(e.description&&e.elements.unshift({tag:"h4",id:"dgfw_criteria_"+t._id+"_step_"+i+"_description",classes:["dgfw-step-description"],text:e.description}),t.createAndAppendChild(t._$stepList,{tag:"li",id:"dgfw_criteria_"+t._id+"_step_"+i,classes:["dgfw-criteria-step","step-"+i,0===i?"step-current":""],children:[{tag:"div",id:"dgfw_criteria_"+t._id+"_step_wrapper"+i,classes:["dgfw-criteria-step-wrapper"],children:e.elements}]}))}),this._sourceCriteria){var e=this._sourceCriteria,i=this;setTimeout(function(){i._$stepListContainer.height(i._$stepList.find("li.step-0 > .dgfw-criteria-step-wrapper").height()+60),i._$stepListContainer.addClass("transition"),setTimeout(function(){e._$stepList.remove(),i._$stepListContainer.removeClass("transition"),i._sourceCriteria=!0},800)},100)}else setTimeout(function(){t.readjustSize()},10);this._conditions.subcriteria&&(this._conditions.subcriteria.forEach(function(e,i,n){var a=new E.create(e.id,e.type,e);t._subcriteria.set(e.id,a),t._$element.hasClass("first")&&t._$element.addClass(e.logic.toLowerCase()),t.appendSubcriteriaElement(a.element()),t._bound.push(new s(t._$element,a.elementSelector(),a.changeTypeEvent(),t,"changeCriteriaType")),t._bound.push(new s(t._$element,a.elementSelector(),a.removeEvent(),t,"removeSubcriteria"))}),this._conditions.subcriteria=void 0)}},{key:"removeElement",value:function(){var t=this;this._$element.css({height:this._$element.height()}),this._$element.slideUp(350,function(){t._$element.remove()})}},{key:"removeCriteria",value:function(){var t=this;confirm(a.text("Are you sure you want do remove this condition and all its child conditions?"))&&this._$element.animate({opacity:0},350,function(){t._$element.trigger(t.removeEvent(),[t._id.toString()])})}},{key:"addHighlight",value:function(){this._$element.addClass("highlight")}},{key:"removeHighlight",value:function(){this._$element.removeClass("highlight")}},{key:"removeSubcriteria",value:function(t,e){var i=this._subcriteria.get(e);this._subcriteria["delete"](e),i.removeElement(),this.unbindSelector(i.elementSelector())}},{key:"unbindSelector",value:function(t){var e=new Array;this._bound.forEach(function(i,s){i.selector()===t?i.unbind():e.push(i)}),this._bound=e}},{key:"prevStepButtonText",value:function(){var t;return t=this._currentStep>0?this._currentStep-1:this._currentStep,this._steps[t].stepName||a.text("Back")}},{key:"nextStepButtonText",value:function(){var t;return t=this._currentStep<this._lastStep?this._currentStep+1:this._currentStep,this._steps[t].stepName||a.text("Next")}}]),n}(),o=function(){function i(e,s){t.classCallCheck(this,i),this._id=e,this._value,this._elements,this._inputElementId,this._$inputElement,this._options=s,this._bindings=new Array,this.init()}return t.createClass(i,[{key:"init",value:function(){}},{key:"hookElements",value:function(){this._$inputElement=this._$inputElement||e(document.getElementById(this._inputElementId))}},{key:"elements",value:function(){return this._elements}},{key:"id",value:function(){return this._id}},{key:"elementId",value:function(){return this._inputElementId}},{key:"bindings",value:function(){return this._bindings}}]),i}(),c=function(i){function s(){return t.classCallCheck(this,s),t.possibleConstructorReturn(this,Object.getPrototypeOf(s).apply(this,arguments))}return t.inherits(s,i),t.createClass(s,[{key:"init",value:function(){this._currency=this._options.currency,this._label=this._options.label,this._inputElementId="dgfw_criteria_amount_"+this._id,this._currencyElementId="dgfw_criteria_amount_currency_"+this._id,this._prefixElementId="dgfw_criteria_amount_prefix_"+this._id,this._$prefixElement=null,this._value=this._options.value;var e={tag:"span",id:this._prefixElementId,classes:["dgfw-currency","dgfw-currency-amount"],text:this._currency.symbol};this._elements=[{tag:"label",id:"dgfw_criteria_amount_label_"+this._id,classes:["dgfw-label","dgfw-label-amount"],text:this._label,attributes:{"for":this._inputElementId}}],"left"!==this._currency.position&&"left_space"!==this._currency_position||(e.classes.push("left"),this._elements.push(e)),this._elements.push({tag:"input",id:this._inputElementId,classes:["dgfw-amount"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]",type:"number",step:"0.01",value:this._value}}),"right"!==this._currency.position&&"right_space"!==this._currency_position||(e.classes.push("right"),this._elements.push(e)),this._elements.push({tag:"input",id:this._currencyElementId,classes:["dgfw-amount"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][currency]",type:"hidden",value:this._currency.text}}),t.get(Object.getPrototypeOf(s.prototype),"init",this).call(this)}},{key:"hookElements",value:function(){t.get(Object.getPrototypeOf(s.prototype),"hookElements",this).call(this),this._$prefixElement=this._$prefixElement||e(document.getElementById(this._prefixElementId)),this._$currencyElement=this._$currencyElement||e(document.getElementById(this._currencyElementId))}},{key:"changeCurrencyTo",value:function(t){this.hookElements(),this._currency=t,this._$prefixElement.text(this._currency.symbol),this._$currencyElement.val(t.text)}},{key:"validate",value:function(){this.hookElements();var t=parseFloat(this._$inputElement.val()),e=!1;return this._value=t,e=!0,this.format(),e}},{key:"value",value:function(){var t=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return t&&(this._value=parseFloat(t),this.format()),this._value}},{key:"setMin",value:function(t){this.hookElements(),this._minValue=parseFloat(t),this._$inputElement.attr("min",this._minValue),this._minValue>this._value&&this.value(this._minValue)}},{key:"setMax",value:function(t){this.hookElements(),this._maxValue=parseFloat(t),this._$inputElement.attr("max",this._maxValue),this._maxValue<this._value&&this.value(this._maxValue)}},{key:"format",value:function(){this.hookElements();var t=2,e=999,i="\\d(?=(\\d{"+(e||3)+"})+"+(t>0?"\\.":"$")+")",s=this._value.toFixed(Math.max(0,~~t)).replace(new RegExp(i,"g"),"$&,");this._$inputElement.val(s)}}]),s}(o),l=function(i){function s(){return t.classCallCheck(this,s),t.possibleConstructorReturn(this,Object.getPrototypeOf(s).apply(this,arguments))}return t.inherits(s,i),t.createClass(s,[{key:"init",value:function(){this._type="amounts",this._sourceCriteria&&this.takeOverFromSource(),this._currency=decomGifts.screen.data.currency,this._minAmount=new c(this._id+"-min_amount",{currency:this._currency,label:a.text("Min amount"),value:this._conditions.min_amount?this._conditions.min_amount.value:0}),this._maxAmount=new c(this._id+"-max_amount",{currency:this._currency,label:a.text("Max amount"),value:this._conditions.max_amount?this._conditions.max_amount.value:0}),this._steps=new Array,this._steps[0]={description:a.text("Set amount range. Leve empty for no limits."),elements:[{tag:"div",id:"dgfw_criteria_amounts_min_container_"+this._id,classes:["dgfw-criteria-input-container"],children:this._minAmount.elements()},{tag:"div",id:"dgfw_criteria_amounts_max_container_"+this._id,classes:["dgfw-criteria-input-container"],children:this._maxAmount.elements()}]},this.showCriteria(),this._bindings.push({selector:"#"+this._minAmount.elementId(),event:"focusout",object:this,method:"updateMinAmount"},{selector:"#"+this._maxAmount.elementId(),event:"focusout",object:this,method:"updateMaxAmount"}),t.get(Object.getPrototypeOf(s.prototype),"init",this).call(this)}},{key:"changeCurrency",value:function(){this._$currencySelect||(this._$currencySelect=e(document.getElementById(this._currencySelectId))),this._currency=this._currencies.get(this._$currencySelect.val()),this._minAmount.changeCurrencyTo(this._currency),this._maxAmount.changeCurrencyTo(this._currency)}},{key:"updateMinAmount",value:function(){this._minAmount.validate()}},{key:"updateMaxAmount",value:function(){this._maxAmount.validate()}}]),s}(r),d=function(e){function i(){return t.classCallCheck(this,i),t.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return t.inherits(i,e),t.createClass(i,[{key:"init",value:function(){this._label=this._options.label,this._inputElementId="dgfw_criteria_items_"+this._id,this._value=this._options.value,this._elements=[{tag:"label",id:"dgfw_criteria_items_label_"+this._id,classes:["dgfw-label","dgfw-label-items"],text:this._label,attributes:{"for":this._inputElementId}},{tag:"input",id:this._inputElementId,classes:["dgfw-items"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]",type:"number",step:"1",value:this._value}}],t.get(Object.getPrototypeOf(i.prototype),"init",this).call(this)}},{key:"validate",value:function(){this.hookElements();var t=parseFloat(this._$inputElement.val()),e=!1;return t>=this._minValue&&t<=this._maxValue&&(this._value=t,e=!0),this.format(),e}},{key:"value",value:function(){var t=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return t&&(this._value=parseFloat(t),this.format()),this._value}},{key:"setMin",value:function(t){this.hookElements(),this._minValue=parseFloat(t),this._$inputElement.attr("min",this._minValue),this._minValue>this._value&&this.value(this._minValue)}},{key:"setMax",value:function(t){this.hookElements(),this._maxValue=parseFloat(t),this._$inputElement.attr("max",this._maxValue),this._maxValue<this._value&&this.value(this._maxValue)}},{key:"format",value:function(){this.hookElements();var t=0,e=3,i="\\d(?=(\\d{"+(e||3)+"})+"+(t>0?"\\.":"$")+")",s=this._value.toFixed(Math.max(0,~~t)).replace(new RegExp(i,"g"),"$&,");this._$inputElement.val(s)}}]),i}(o),h=function(e){function i(){return t.classCallCheck(this,i),t.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return t.inherits(i,e),t.createClass(i,[{key:"init",value:function(){this._type="items",this._sourceCriteria&&this.takeOverFromSource(),this._minItems=new d(this._id+"-min_items",{label:a.text("Min items"),value:this._conditions.min_items?this._conditions.min_items.value:0}),this._maxItems=new d(this._id+"-max_items",{label:a.text("Max items"),value:this._conditions.max_items?this._conditions.max_items.value:0}),this._steps=new Array,this._steps[0]={description:a.text("Set items range. Leave empty for no limits."),elements:[{tag:"div",id:"dgfw_criteria_items_min_container_"+this._id,classes:["dgfw-criteria-input-container"],children:this._minItems.elements()},{tag:"div",id:"dgfw_criteria_items_max_container_"+this._id,classes:["dgfw-criteria-input-container"],children:this._maxItems.elements()}]},this.showCriteria(),t.get(Object.getPrototypeOf(i.prototype),"init",this).call(this)}},{key:"updateMinItems",value:function(){this._minItems.validate()&&(this._maxItems.setMin(this._minItems.value()),this._minItems.value()>this._maxItems.value()&&this._maxItems.value(this._minItems.value()))}},{key:"updateMaxItems",value:function(){this._maxItems.validate()&&this._minItems.setMax(this._maxItems.value())}}]),i}(r),u=function(s){function n(){return t.classCallCheck(this,n),t.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return t.inherits(n,s),t.createClass(n,[{key:"init",value:function(){var e=this;this._postType=this._options.postType,this._label=this._options.label,this._inputElementId="dgfw_criteria_posts_"+this._id,this._containerId="dgfw_critera_posts_select_"+this._id,this._selectedListId="dgfw_criteria_posts_"+this._id+"_selected_list",this._advancedContainerId="dgfw_criteria_posts_advanced_settings_"+this._id,this._advancedListId="dgfw_criteria_posts_"+this._id+"_advanced_list",this._navPrevId="dgfw_criteria_posts_select_nav_prev_"+this._id,this._navNextId="dgfw_criteria_posts_select_nav_next_"+this._id,this._statusCurrentPageId="dgfw_criteria_posts_select_nav_status_current_"+this._id,this._statusTotalPagesId="dgfw_criteria_posts_select_nav_status_total_"+this._id,this._value=new Object,this._options.value&&(this._value=this._options.value),this._currentPage=0,this._totalProducts=0,this._totalPages=1,this._productsPerPage=5;var i=new Array;decomGifts.screen.data.products&&(this._totalProducts=decomGifts.screen.data.products.length,this._totalPages=Math.ceil(this._totalProducts/this._productsPerPage),decomGifts.screen.data.products.forEach(function(t,s,n){i[Math.floor(s/e._productsPerPage)]=i[Math.floor(s/e._productsPerPage)]||new Array,i[Math.floor(s/e._productsPerPage)].push(e.productElement(t))}));var s=new Array;i.forEach(function(t,i,n){s[i]={tag:"div",id:e._containerId+"_page_"+i,classes:["dgfw-select-posts-container-page","page-"+i,0===i?"page-current":""],children:t}});var r={tag:"div",id:this._selectedListId,classes:["dgfw-selected-posts"],children:[]},o={tag:"div",id:this._advancedListId,classes:["dgfw-advanced-posts"],children:[]};if(Object.keys(this._value).length)for(var c in this._value)this._value[c]&&(r.children.push(this.selectedProductElement(this.post(parseInt(c)),!1)),o.children.push(this.advancedProductElement(this.post(parseInt(c)),this._value[c])));else r.classes.push("invisible");this._elements=[r,{tag:"div",id:this._containerId,classes:["dgfw-select-wrapper","dgfw-select-posts","current-page-0"],children:s},{tag:"input",id:this._inputElementId,classes:["dgfw-products"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]",type:"hidden",value:Object.getOwnPropertyNames(this._value).join(",")}},{tag:"input",id:this._inputElementId+"_post_types",classes:["dgfw-products"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][post_types][]",type:"hidden",value:this._postType}}],this._totalPages>1&&this._elements.splice(1,0,{tag:"div",id:"dgfw_criteria_posts_select_nav_"+this._id,classes:["dgfw-select-posts-nav"],children:[{tag:"button",id:this._navPrevId,classes:["dgfw-select-posts-nav-prev","button","dgfw-button-secondary","dashicons-before","dashicons-arrow-left"]},{tag:"span",id:"dgfw_criteria_select_nav_status_"+this._id,classes:["dgfw-select-posts-nav-status"],children:[{tag:"span",id:"",classes:[],text:a.text("Page ")},{tag:"span",id:this._statusCurrentPageId,classes:["dgfw-select-posts-nav-status-number"],text:this._currentPage+1},{tag:"span",id:"",classes:[],text:a.text(" of ")},{tag:"span",id:this._statusTotalPagesId,classes:["dgfw-select-posts-nav-status-number"],text:this._totalPages}]},{tag:"button",id:this._navNextId,classes:["dgfw-select-posts-nav-prev","button","dgfw-button-secondary","dashicons-before","dashicons-arrow-right"]}]}),this._advancedElements=[{tag:"div",id:this._advancedContainerId,classes:["dgfw-advanced-wrapper"],children:[o]}],this._bindings.push({selector:"#"+this._containerId,event:"mouseover",object:this,method:"loadNextPage"},{selector:"#"+this._navPrevId,event:"click",object:this,method:"previousPage"},{selector:"#"+this._navNextId,event:"click",object:this,method:"nextPage"},{selector:".dgfw-posts-select-post",event:"click",object:this,method:"toggleSelectPost"},{selector:".dgfw-posts-selected-remove",event:"click",object:this,method:"removeSelectedPost"}),t.get(Object.getPrototypeOf(n.prototype),"init",this).call(this)}},{key:"hookElements",value:function(){t.get(Object.getPrototypeOf(n.prototype),"hookElements",this).call(this),this._$containerElement=this._$containerElement||e(document.getElementById(this._containerId)),this._$selectedListElement=this._$selectedListElement||e(document.getElementById(this._selectedListId)),this._$currentPageStatus=this._$currentPageStatus||e(document.getElementById(this._statusCurrentPageId)),this._$advancedListElement=this._$advancedListElement||e(document.getElementById(this._advancedListId))}},{key:"containerId",value:function(){return this._containerId}},{key:"loadNextPage",value:function(){this.hookElements(),i.info("Loading more products...")}},{key:"productElement",value:function(t){
var e=["dgfw-posts-select-post"];return this._value[t.id]&&e.push("selected"),{tag:"div",id:"dgfw_criteria_posts_"+this._id+"_product_"+t.id,classes:e,attributes:{"data-decom-id":t.id},children:[{tag:"h4",classes:["dgfw-posts-select-post-title"],text:t.title},{tag:"div",classes:["dgfw-posts-select-post-img"],attributes:{style:"background-image: url("+t.img+");"}}]}}},{key:"selectedProductElement",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],i=["dgfw-posts-selected-post"];return e&&i.push("invisible"),{tag:"div",id:"dgfw_criteria_posts_"+this._id+"_selected_"+t.id,classes:i,attributes:{"data-decom-id":t.id},children:[{tag:"h4",classes:["dgfw-posts-select-post-title"],text:t.title},{tag:"div",classes:["dgfw-posts-select-post-img"],attributes:{style:"background-image: url("+t.img+");"}},{tag:"span",id:"dgfw_criteria_posts_selected_remove_"+t.id,classes:["dgfw-posts-selected-remove","dashicons-before","dashicons-no"],attributes:{"data-decom-id":t.id}}]}}},{key:"advancedProductMinItemsInputId",value:function(t){return"dgfw_criteria_posts_advanced_min_items_"+t}},{key:"advancedProductElement",value:function(t,e){var i=["dgfw-posts-advanced-post"],s=this.advancedProductMinItemsInputId(t.id);return{tag:"div",id:"dgfw_criteria_posts_"+this._id+"_advanced_"+t.id,classes:i,attributes:{"data-decom-id":t.id},children:[{tag:"h4",classes:["dgfw-posts-select-post-title"],text:t.title},{tag:"div",classes:["dgfw-posts-select-post-img"],attributes:{style:"background-image: url("+t.img+");"}},{tag:"span",id:"dgfw_criteria_posts_advanced_remove_"+t.id,classes:["dgfw-posts-selected-remove","dashicons-before","dashicons-no"],attributes:{"data-decom-id":t.id}},{tag:"input",id:s,classes:["dgfw-posts-advanced-min-items"],attributes:{type:"number",name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]["+t.id+"][min_items]",value:e.min_items}}]}}},{key:"toggleSelectPost",value:function(t){this.hookElements();var i=e(t.currentTarget),s=parseInt(i.data("decom-id"));i.toggleClass("selected"),this._value[s]?(delete this._value[s],this.removeFromList(s)):(this._value[s]={min_items:1},this.addToList(s)),this._$inputElement.val(Object.getOwnPropertyNames(this._value).join(","))}},{key:"removeSelectedPost",value:function(t){this.hookElements();var i=e(t.currentTarget),s=parseInt(i.data("decom-id"));i=e("#dgfw_criteria_posts_"+this._id+"_product_"+s),i.removeClass("selected"),this._value[s]&&(delete this._value[s],this.removeFromList(s))}},{key:"addToList",value:function(t){var e=this,i=this.post(t);this.createAndAppendChild(this._$selectedListElement,this.selectedProductElement(i)),this.createAndAppendChild(this._$advancedListElement,this.advancedProductElement(i,{min_items:1})),setTimeout(function(){e._$selectedListElement.removeClass("invisible"),e.$postElement(t).removeClass("invisible"),setTimeout(function(){e.selectionChanged()},200)},50)}},{key:"removeFromList",value:function(t){var e=this,i=this.$postElement(t),s=this.$advancedPostElement(t);i.addClass("invisible"),setTimeout(function(){0===Object.keys(e._value).length&&e._$selectedListElement.addClass("invisible"),i.remove(),s.remove(),setTimeout(function(){e.selectionChanged()},200)},50)}},{key:"selectionChangedEvent",value:function(){return"DGFW.SelectionChanged_"+this._id}},{key:"selectionChanged",value:function(){this._$inputElement.trigger(this.selectionChangedEvent())}},{key:"post",value:function(t){var e=!1;return decomGifts.screen.data.products.forEach(function(i,s,n){i.id===t&&(e=i)}),e}},{key:"$postElement",value:function(t){return e(document.getElementById("dgfw_criteria_posts_"+this._id+"_selected_"+t))}},{key:"$advancedPostElement",value:function(t){return e(document.getElementById("dgfw_criteria_posts_"+this._id+"_advanced_"+t))}},{key:"createAndAppendChild",value:function(t,i){var s=this,n=e(document.createElement(i.tag));if(n.attr("id",i.id),i.classes&&n.addClass(i.classes.join(" ")),i.attributes)for(var a in i.attributes)n.attr(a,i.attributes[a]);return i.text&&n.text(i.text),t.append(n),i.children&&i.children.forEach(function(t,e,i){s.createAndAppendChild(n,t)}),n}},{key:"previousPage",value:function(){this.hookElements(),this._currentPage-=this._currentPage>0?1:0,this._$containerElement.find(".page-"+(this._currentPage+1)).removeClass("page-current"),this._$containerElement.find(".page-"+this._currentPage).removeClass("page-prev").addClass("page-current"),this.updateCurrentPageStatus()}},{key:"nextPage",value:function(){this.hookElements(),this._currentPage+=this._currentPage<this._totalPages-1?1:0,this._$containerElement.find(".page-"+(this._currentPage-1)).removeClass("page-current").addClass("page-prev"),this._$containerElement.find(".page-"+this._currentPage).addClass("page-current"),this.updateCurrentPageStatus()}},{key:"updateCurrentPageStatus",value:function(){this.hookElements(),this._$currentPageStatus.text(this._currentPage+1)}},{key:"advancedElements",value:function(){return this._advancedElements}}]),n}(o),_=function(e){function i(){return t.classCallCheck(this,i),t.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return t.inherits(i,e),t.createClass(i,[{key:"init",value:function(){this._type="products",this._sourceCriteria&&this.takeOverFromSource(),this._products=new u(this._id+"-posts",{label:a.text("Posts"),postType:"product",value:this._conditions.posts?this._conditions.posts.value:!1}),this._steps=new Array;var e=this._products.elements(),s=this._products.advancedElements();this._steps[0]={stepName:a.text("Select Products"),description:a.text("Select products this gift category applies for."),elements:[{tag:"div",id:"dgfw_criteria_products_container_"+this._id,classes:["dgfw-criteria-input-container"],children:e}]},this._steps[1]={stepName:a.text("Product Quantities"),description:a.text("Set minimum quantity for each selected product."),elements:[{tag:"div",id:"dgfw_criteria_products_advanced_"+this._id,classes:["dgfw-criteria-input-container"],children:s}]},this.showCriteria(),this._bindings=this._bindings.concat(this._products.bindings()),this._bindings.push({selector:"#"+this._products.elementId(),event:this._products.selectionChangedEvent(),object:this,method:"readjustSize"}),t.get(Object.getPrototypeOf(i.prototype),"init",this).call(this)}}]),i}(r),p=function(e){function i(){return t.classCallCheck(this,i),t.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return t.inherits(i,e),t.createClass(i,[{key:"init",value:function(){var e=this;this._taxonomy=this._options.taxonomy,this._label=this._options.label,this._value=this._options.value||new Array,this._inputElementId="dgfw_criteria_terms_"+this._id,this._inputElementName="dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]";var s=new Array;decomGifts.screen.data.productCategories&&decomGifts.screen.data.productCategories.forEach(function(t,i,n){s.push(e.termElement(t))}),this._elements=[{tag:"div",id:"dgfw_select_terms_"+this._id,classes:["dgfw-checkbox-group-wrapper"],children:s},{tag:"input",id:this._inputElementId+"_taxonomy",classes:["dgfw-products"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][taxonomy]",type:"hidden",value:this._taxonomy}}],t.get(Object.getPrototypeOf(i.prototype),"init",this).call(this)}},{key:"termElement",value:function(t){var e={type:"checkbox",name:this._inputElementName+"[]",value:t.id};return this._value.forEach(function(i,s,n){parseInt(i)===t.id&&(e.checked="checked")}),{tag:"div",id:"dgfw_criteria_terms_"+this._id+"_term_"+t.id,classes:["dgfw-terms-select"],attributes:{"data-decom-id":t.id},children:[{tag:"input",id:"dgfw_terms_select_"+this._id+"_checkbox_"+t.id,classes:["dgfw-terms-select-checkbox"],attributes:e},{tag:"label",classes:["dgfw-terms-select-label"],text:t.title,attributes:{"for":"dgfw_terms_select_"+this._id+"_checkbox_"+t.id}}]}}}]),i}(o),m=function(e){function i(){return t.classCallCheck(this,i),t.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return t.inherits(i,e),t.createClass(i,[{key:"init",value:function(){this._type="product_categories",this._sourceCriteria&&this.takeOverFromSource(),this._terms=new p(this._id+"-terms",{label:a.text("Terms"),taxonomy:"product_cat",value:this._conditions.terms?this._conditions.terms.value:!1}),this._steps=new Array,this._steps[0]={description:a.text("Select product categories this gift category applies for."),elements:[{tag:"div",id:"dgfw_criteria_product_cats_container_"+this._id,classes:["dgfw-criteria-input-container"],children:this._terms.elements()}]},this.showCriteria(),this._bindings=this._bindings.concat(this._terms.bindings()),t.get(Object.getPrototypeOf(i.prototype),"init",this).call(this)}}]),i}(r),g=function(s){function n(){return t.classCallCheck(this,n),t.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return t.inherits(n,s),t.createClass(n,[{key:"init",value:function(){var e=this;this._label=this._options.label,this._inputElementId="dgfw_criteria_users_"+this._id,this._containerId="dgfw_critera_users_select_"+this._id,this._selectedListId="dgfw_criteria_users_"+this._id+"_selected_list",this._navPrevId="dgfw_criteria_users_select_nav_prev_"+this._id,this._navNextId="dgfw_criteria_users_select_nav_next_"+this._id,this._statusCurrentPageId="dgfw_criteria_users_select_nav_status_current_"+this._id,this._statusTotalPagesId="dgfw_criteria_users_select_nav_status_total_"+this._id,this._value=new Object,this._options.value&&this._options.value.split(",").forEach(function(t){parseInt(t)&&(e._value[t]=t)}),this._currentPage=0,this._totalUsers=0,this._totalPages=1,this._usersPerPage=5;var i=new Array;decomGifts.screen.data.users&&(this._totalUsers=decomGifts.screen.data.users.length,this._totalPages=Math.ceil(this._totalUsers/this._usersPerPage),decomGifts.screen.data.users.forEach(function(t,s,n){i[Math.floor(s/e._usersPerPage)]=i[Math.floor(s/e._usersPerPage)]||new Array,i[Math.floor(s/e._usersPerPage)].push(e.userElement(t))}));var s=new Array;i.forEach(function(t,i,n){s[i]={tag:"div",id:e._containerId+"_page_"+i,classes:["dgfw-select-users-container-page","page-"+i,0===i?"page-current":""],children:t}});var r={tag:"div",id:this._selectedListId,classes:["dgfw-selected-users"],children:[]};if(Object.keys(this._value).length)for(var o in this._value)this._value[o]&&r.children.push(this.selectedUserElement(this.user(parseInt(o)),!1));else r.classes.push("invisible");this._elements=[r,{tag:"div",id:this._containerId,classes:["dgfw-select-wrapper","dgfw-select-users","current-page-0"],children:s},{tag:"input",id:this._inputElementId,classes:["dgfw-users"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]",type:"hidden",value:Object.getOwnPropertyNames(this._value).join(",")}}],this._totalPages>1&&this._elements.splice(1,0,{tag:"div",id:"dgfw_criteria_users_select_nav_"+this._id,classes:["dgfw-select-users-nav"],children:[{tag:"button",id:this._navPrevId,classes:["dgfw-select-users-nav-prev","button","dgfw-button-secondary","dashicons-before","dashicons-arrow-left"]},{tag:"span",id:"dgfw_criteria_select_nav_status_"+this._id,classes:["dgfw-select-users-nav-status"],children:[{tag:"span",id:"",classes:[],text:a.text("Page ")},{tag:"span",id:this._statusCurrentPageId,classes:["dgfw-select-users-nav-status-number"],text:this._currentPage+1},{tag:"span",id:"",classes:[],text:a.text(" of ")},{tag:"span",id:this._statusTotalPagesId,classes:["dgfw-select-users-nav-status-number"],text:this._totalPages}]},{tag:"button",id:this._navNextId,classes:["dgfw-select-users-nav-prev","button","dgfw-button-secondary","dashicons-before","dashicons-arrow-right"]}]}),this._bindings.push({selector:"#"+this._containerId,event:"mouseover",object:this,method:"loadNextPage"},{selector:"#"+this._navPrevId,event:"click",object:this,method:"previousPage"},{selector:"#"+this._navNextId,event:"click",object:this,method:"nextPage"},{selector:".dgfw-users-select-user",event:"click",object:this,method:"toggleSelectUser"},{selector:".dgfw-users-selected-remove",event:"click",object:this,method:"removeSelectedUser"}),t.get(Object.getPrototypeOf(n.prototype),"init",this).call(this)}},{key:"hookElements",value:function(){t.get(Object.getPrototypeOf(n.prototype),"hookElements",this).call(this),this._$containerElement=this._$containerElement||e(document.getElementById(this._containerId)),this._$selectedListElement=this._$selectedListElement||e(document.getElementById(this._selectedListId)),this._$currentPageStatus=this._$currentPageStatus||e(document.getElementById(this._statusCurrentPageId))}},{key:"containerId",value:function(){return this._containerId}},{key:"loadNextPage",value:function(){this.hookElements(),i.info("Loading more users...")}},{key:"userElement",value:function(t){var e=["dgfw-users-select-user"];return this._value[t.id]&&e.push("selected"),{tag:"div",id:"dgfw_criteria_users_"+this._id+"_user_"+t.id,classes:e,attributes:{"data-decom-id":t.id},children:[{tag:"h4",classes:["dgfw-users-select-user-name"],text:t.displayName},{tag:"div",classes:["dgfw-users-select-user-img"],attributes:{style:"background-image: url("+t.img+");"}}]}}},{key:"selectedUserElement",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!0:arguments[1],i=["dgfw-users-selected-user"];return e&&i.push("invisible"),{tag:"div",id:"dgfw_criteria_users_"+this._id+"_selected_"+t.id,classes:i,attributes:{"data-decom-id":t.id},children:[{tag:"h4",classes:["dgfw-users-select-user-name"],text:t.displayName},{tag:"div",classes:["dgfw-users-select-user-img"],attributes:{style:"background-image: url("+t.img+");"}},{tag:"span",id:"dgfw_criteria_users_selected_remove_"+t.id,classes:["dgfw-users-selected-remove","dashicons-before","dashicons-no"],attributes:{"data-decom-id":t.id}}]}}},{key:"toggleSelectUser",value:function(t){this.hookElements();var i=e(t.currentTarget),s=parseInt(i.data("decom-id"));i.toggleClass("selected"),this._value[s]?(delete this._value[s],this.removeFromList(s)):(this._value[s]=s,this.addToList(s)),this._$inputElement.val(Object.getOwnPropertyNames(this._value).join(","))}},{key:"removeSelectedUser",value:function(t){this.hookElements();var i=e(t.currentTarget),s=parseInt(i.data("decom-id"));i=e("#dgfw_criteria_users_"+this._id+"_user_"+s),i.removeClass("selected"),this._value[s]&&(delete this._value[s],this.removeFromList(s)),this._$inputElement.val(Object.getOwnPropertyNames(this._value).join(","))}},{key:"addToList",value:function(t){var e=this,i=this.user(t);this.createAndAppendChild(this._$selectedListElement,this.selectedUserElement(i)),setTimeout(function(){e._$selectedListElement.removeClass("invisible"),e.$userElement(t).removeClass("invisible"),setTimeout(function(){e.selectionChanged()},300)},50)}},{key:"removeFromList",value:function(t){var e=this,i=this.$userElement(t);i.addClass("invisible"),setTimeout(function(){0===Object.keys(e._value).length&&e._$selectedListElement.addClass("invisible"),i.remove(),setTimeout(function(){e.selectionChanged()},300)},50)}},{key:"selectionChangedEvent",value:function(){return"DGFW.SelectionChanged_"+this._id}},{key:"selectionChanged",value:function(){this._$inputElement.trigger(this.selectionChangedEvent())}},{key:"user",value:function r(t){var r=!1;return decomGifts.screen.data.users.forEach(function(e,i,s){e.id===t&&(r=e)}),r}},{key:"$userElement",value:function(t){return e(document.getElementById("dgfw_criteria_users_"+this._id+"_selected_"+t))}},{key:"createAndAppendChild",value:function(t,i){var s=this,n=e(document.createElement(i.tag));if(n.attr("id",i.id),i.classes&&n.addClass(i.classes.join(" ")),i.attributes)for(var a in i.attributes)n.attr(a,i.attributes[a]);return i.text&&n.text(i.text),t.append(n),i.children&&i.children.forEach(function(t,e,i){s.createAndAppendChild(n,t)}),n}},{key:"previousPage",value:function(){this.hookElements(),this._currentPage-=this._currentPage>0?1:0,this._$containerElement.find(".page-"+(this._currentPage+1)).removeClass("page-current"),this._$containerElement.find(".page-"+this._currentPage).removeClass("page-prev").addClass("page-current"),this.updateCurrentPageStatus()}},{key:"nextPage",value:function(){this.hookElements(),this._currentPage+=this._currentPage<this._totalPages-1?1:0,this._$containerElement.find(".page-"+(this._currentPage-1)).removeClass("page-current").addClass("page-prev"),this._$containerElement.find(".page-"+this._currentPage).addClass("page-current"),this.updateCurrentPageStatus()}},{key:"updateCurrentPageStatus",value:function(){this.hookElements(),this._$currentPageStatus.text(this._currentPage+1)}}]),n}(o),v=function(e){function i(){return t.classCallCheck(this,i),t.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return t.inherits(i,e),t.createClass(i,[{key:"init",value:function(){this._type="users",this._sourceCriteria&&this.takeOverFromSource(),this._users=new g(this._id+"-users",{label:a.text("Users"),value:this._conditions.users?this._conditions.users.value:!1}),this._steps=new Array;var e=this._users.elements();this._steps[0]={description:a.text("Select users this gift category applies for."),elements:[{tag:"div",id:"dgfw_criteria_users_container_"+this._id,classes:["dgfw-criteria-input-container"],children:e}]},this.showCriteria(),this._bindings=this._bindings.concat(this._users.bindings()),this._bindings.push({selector:"#"+this._users.elementId(),event:this._users.selectionChangedEvent(),object:this,method:"readjustSize"}),t.get(Object.getPrototypeOf(i.prototype),"init",this).call(this)}}]),i}(r),f=function(e){function i(){return t.classCallCheck(this,i),t.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return t.inherits(i,e),t.createClass(i,[{key:"init",value:function(){var e=this;this._label=this._options.label,this._inputElementId="dgfw_criteria_roles_"+this._id,this._inputElementName="dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]",this._value=this._options.value||new Array;var s=new Array;decomGifts.screen.data.roles&&decomGifts.screen.data.roles.forEach(function(t,i,n){s.push(e.roleElement(t))}),this._elements=[{tag:"div",id:"dgfw_select_roles_"+this._id,classes:["dgfw-checkbox-group-wrapper"],children:s}],t.get(Object.getPrototypeOf(i.prototype),"init",this).call(this)}},{key:"roleElement",value:function(t){var e={type:"checkbox",name:this._inputElementName+"[]",value:t.name};return this._value.forEach(function(i,s,n){i===t.name&&(e.checked="checked")}),{tag:"div",id:"dgfw_criteria_roles_"+this._id+"_role_"+t.name,classes:["dgfw-roles-select"],attributes:{"data-decom-id":t.name},children:[{tag:"input",id:"dgfw_roles_select_"+this._id+"_checkbox_"+t.name,classes:["dgfw-roles-select-checkbox"],attributes:e},{tag:"label",classes:["dgfw-roles-select-label"],text:t.title,attributes:{"for":"dgfw_roles_select_"+this._id+"_checkbox_"+t.name}}]}}}]),i}(o),y=function(e){function i(){return t.classCallCheck(this,i),t.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return t.inherits(i,e),t.createClass(i,[{key:"init",value:function(){this._type="user_roles",this._sourceCriteria&&this.takeOverFromSource(),this._roles=new f(this._id+"-roles",{label:a.text("Roles"),value:this._conditions.roles?this._conditions.roles.value:!1}),this._steps=new Array,this._steps[0]={description:a.text("Select user roles this gift category applies for."),elements:[{tag:"div",id:"dgfw_criteria_roles_container_"+this._id,classes:["dgfw-criteria-input-container"],children:this._roles.elements()}]},this.showCriteria(),this._bindings=this._bindings.concat(this._roles.bindings()),t.get(Object.getPrototypeOf(i.prototype),"init",this).call(this)}}]),i}(r),b=function(i){function s(){return t.classCallCheck(this,s),t.possibleConstructorReturn(this,Object.getPrototypeOf(s).apply(this,arguments))}return t.inherits(s,i),t.createClass(s,[{key:"init",value:function(){if(this._label=this._options.label,this._dateInputElementId="dgfw_criteria_date_"+this._id,this._timeInputElementId="dgfw_criteria_time_"+this._id,this._value=new Object,this._options.value)this._value=this._options.value;else{var e=new Date,i=new Object;i.dd=e.getDate(),i.mm=e.getMonth()+1,i.yyyy=e.getFullYear(),i.hh=e.getHours(),i.ii=e.getMinutes();for(var n in i)i[n]<10&&(i[n]="0"+i[n]);this._value.date=i.yyyy+"-"+i.mm+"-"+i.dd,this._value.time=i.hh+":"+i.ii}this._elements=[{tag:"label",id:"dgfw_criteria_date_label_"+this._id,classes:["dgfw-label-date"],text:this._label,attributes:{"for":this._dateInputElementId}},{tag:"input",id:this._dateInputElementId,classes:["dgfw-date"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value][date]",type:"date",value:this._value.date}},{tag:"label",id:"dgfw_criteria_time_label_"+this._id,classes:["dgfw-label-time"],text:a.text(" at "),attributes:{"for":this._timeInputElementId}},{tag:"input",id:this._timeInputElementId,classes:["dgfw-time"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value][time]",type:"time",value:this._value.time}}],t.get(Object.getPrototypeOf(s.prototype),"init",this).call(this)}},{key:"hookElements",value:function(){this._$dateInputElement=this._$dateInputElement||e(document.getElementById(this._dateInputElementId)),this._$timeInputElement=this._$timeInputElement||e(document.getElementById(this._timeInputElementId))}},{key:"dateElementId",value:function(){return this._dateInputElementId}},{key:"timeElementId",value:function(){return this._timeInputElementId}},{key:"updateDate",value:function(){this.hookElements(),this._value.date=this._$dateInputElement.val()}},{key:"updateTime",value:function(){this.hookElements(),this._value.time=this._$timeInputElement.val()}}]),s}(o),w=function(e){function i(){return t.classCallCheck(this,i),t.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return t.inherits(i,e),t.createClass(i,[{key:"init",value:function(){this._type="periods",this._sourceCriteria&&this.takeOverFromSource(),this._start=new b(this._id+"-start",{label:a.text("Start date"),value:this._conditions.start?this._conditions.start.value:!1}),this._end=new b(this._id+"-end",{label:a.text("End date"),value:this._conditions.end?this._conditions.end.value:!1}),this._steps=new Array,this._steps[0]={description:a.text("Set start and end of this period."),elements:[{tag:"div",id:"dgfw_criteria_periods_start_container_"+this._id,classes:["dgfw-criteria-input-container","dgfw-criteria-period-container"],children:this._start.elements()},{tag:"div",id:"dgfw_criteria_periods_end_container_"+this._id,classes:["dgfw-criteria-input-container","dgfw-criteria-period-container"],children:this._end.elements()}]},this.showCriteria(),this._bindings.push({selector:"#"+this._start.dateElementId(),event:"focusout",object:this,method:"updateStartDate"},{selector:"#"+this._start.timeElementId(),event:"focusout",object:this,method:"updateStartTime"},{selector:"#"+this._end.dateElementId(),event:"focusout",object:this,method:"updateEndDate"},{selector:"#"+this._end.timeElementId(),event:"focusout",object:this,method:"updateEndTime"}),t.get(Object.getPrototypeOf(i.prototype),"init",this).call(this)}},{key:"updateStartDate",value:function(){this._start.updateDate()}},{key:"updateStartTime",value:function(){this._start.updateTime()}},{key:"updateEndDate",value:function(){this._end.updateDate()}},{key:"updateEndTime",value:function(){this._end.updateTime()}}]),i}(r),C=new Map([["amounts",l],["items",h],["periods",w],["products",_],["product_categories",m],["users",v],["user_roles",y],["default",l]]),E=function(){function e(){t.classCallCheck(this,e)}return t.createClass(e,null,[{key:"create",value:function(t,e){var i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return C.has(e)||(e="default"),new(C.get(e))(t,i)}},{key:"createAndScrollTo",value:function(t,e){var i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return i.scrollTo=!0,this.create(t,e,i)}},{key:"createFrom",value:function(t,e){return C.has(e)||(e="default"),new(C.get(e))(t.id(),t.conditions(),t)}}]),e}(),k=function(){function i(n){var a=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(t.classCallCheck(this,i),this._id=n.id,this._name=n.name,this._bound=new Array,this._$element=e(document.getElementById(n.elementId)),this._$description=e(document.getElementById(n.descriptionId)),this._$addButton=e(document.getElementById(n.addButtonId)),this._criteria=new Map,a){var r=E.create(a.id,a.type,a);this._criteria.set(this._criteria.size.toString(),r),e("#dgfw-loading").fadeOut(),this.updateDescription(),this.appendCriteriaElement(r.element()),this._bound.push(new s(this._$element,r.elementSelector(),r.changeTypeEvent(),this,"changeCriteriaType")),this._bound.push(new s(this._$element,r.elementSelector(),r.removeEvent(),this,"removeCriteria"))}}return t.createClass(i,[{key:"addCriteria",value:function(){var t=new l(this._criteria.size,{scrollTo:!0});this._criteria.set(this._criteria.size.toString(),t),this.updateDescription(),this._$addButton.hide(),this.appendCriteriaElement(t.element()),this._bound.push(new s(this._$element,t.elementSelector(),t.changeTypeEvent(),this,"changeCriteriaType")),this._bound.push(new s(this._$element,t.elementSelector(),t.removeEvent(),this,"removeCriteria"))}},{key:"removeCriteria",value:function(t,e){var i=this._criteria.get(e);this._criteria["delete"](e),i.removeElement(),this.unbindSelector(i.elementSelector()),this.updateDescription(),this._$addButton.show()}},{key:"updateDescription",value:function(){var t="";this._$description.text(t)}},{key:"appendCriteriaElement",value:function(t){this._$description.after(t)}},{key:"changeCriteriaType",value:function(t,e,i){var s=new E.createFrom(this._criteria.get(e),i);this._criteria.set(e,s)}},{key:"unbindSelector",value:function(t){var e=new Array;this._bound.forEach(function(i,s){i.selector()===t?i.unbind():e.push(i)}),this._bound=e}}]),i}(),x=function(e){function i(){return t.classCallCheck(this,i),t.possibleConstructorReturn(this,Object.getPrototypeOf(i).apply(this,arguments))}return t.inherits(i,e),t.createClass(i,[{key:"init",value:function(){this._category=new k(this._data.category,this._data.criteria),this._bindings.push({selector:"#dgfw_add_criteria",event:"click",object:this,method:"addCriteria"}),t.get(Object.getPrototypeOf(i.prototype),"init",this).call(this)}},{key:"addCriteria",value:function(){this._category.addCriteria()}}]),i}(n),I=function(i){function s(){return t.classCallCheck(this,s),t.possibleConstructorReturn(this,Object.getPrototypeOf(s).apply(this,arguments))}return t.inherits(s,i),t.createClass(s,[{key:"init",value:function(){this._giftableOptionId="_dgfw_giftable",this._productTypeSelectId="product-type",this._$giftableOption=e(document.getElementById(this._giftableOptionId)),this._$producTypeSelect=e(document.getElementById(this._productTypeSelectId)),this._bindings.push({selector:"#"+this._giftableOptionId,event:"change",object:this,method:"toggleGiftable"},{selector:"#"+this._productTypeSelectId,event:"change",object:this,method:"productTypeChange"},{selector:"#_virtual, #_downloadable",event:"change",object:this,method:"productTypeChange"}),t.get(Object.getPrototypeOf(s.prototype),"init",this).call(this)}},{key:"toggleGiftable",value:function(){var t,i;this._$giftableOption.prop("checked")?(t="show_if",i="hide_if"):(t="hide_if",i="show_if"),e(document.getElementsByClassName(t+this._giftableOptionId)).show(),e(document.getElementsByClassName(i+this._giftableOptionId)).hide()}},{key:"productTypeChange",value:function(){this._$giftableOption.is(":visible")&&this.toggleGiftable()}}]),s}(n),$=new Map([["edit-category",x],["edit-product",I]]),P=function(){function e(){t.classCallCheck(this,e)}return t.createClass(e,null,[{key:"create",value:function(t){return $.has(t.name)?new($.get(t.name))(t.data):void 0}}]),e}(),S=function(){function e(){t.classCallCheck(this,e),decomGifts&&decomGifts.screen&&(this._screen=P.create(decomGifts.screen),this.init())}return t.createClass(e,[{key:"init",value:function(){i.info("Giftable for WooCommerce initialized.")}}]),e}();new S}();