!function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),i=function e(t,i,s){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,s)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(s)},s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},r=function(){function i(){e(this,i)}return t(i,null,[{key:"isEnabled",value:function(){return this._enabled=this._enabled||decomGiftable.debug||!1}},{key:"info",value:function(e){this.isEnabled()&&console.info(e)}},{key:"log",value:function(e){this.isEnabled()&&console.log(e)}},{key:"error",value:function(e){this.isEnabled()&&console.error(e)}}]),i}(),a=function(){function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"body",s=arguments[1],n=arguments[2],a=arguments[3],o=arguments[4],c=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];e(this,i),this._parent=t,this._selector=s,this._event=n,this._object=a,this._method=o,this._callback=function(e){c&&(e.preventDefault(),e.stopPropagation()),a[o].apply(a,arguments)},jQuery(this._parent).on(this._event,this._selector,this._callback),r.info("Bound - parent: "+this._parent+", event: "+this._event+", selector: "+this._selector+", object: "+a+", method: "+o),r.log("Parent:"),r.log(this._parent),r.log("Object:"),r.log(a)}return t(i,[{key:"unbind",value:function(){jQuery(this._parent).off(this._event,this._selector,this._callback),r.info("Unbound - parent: "+this._parent+", event: "+this._event+", selector: "+this._selector),r.log("Parent:"),r.log(this._parent)}},{key:"selector",value:function(){return this._selector}}]),i}(),o=function(){function i(t){e(this,i),this._data=t,this._bound=new Array,this._bindings=new Array,this.init()}return t(i,[{key:"init",value:function(){this.bind()}},{key:"bind",value:function(){var e=this;this._bindings.forEach(function(t,i,s){e._bound.push(new a(e._element,t.selector,t.event,t.object,t.method,t.preventDefault||!0))})}}]),i}(),c=function(){function i(){e(this,i)}return t(i,null,[{key:"loadTranslations",value:function(){this._translations=this._translations||decomGiftable.screen.translations||new Object}},{key:"text",value:function(e){return this.loadTranslations(),this._translations[e]||e}}]),i}(),d=function(){function i(t){var s=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e(this,i),this._id=t,this._conditions=n,this._type=n.type||null,this._currentStep=0,this._subcriteria=new Map,this._subcriteriaLastIndex=-1,this._conditions.subcriteria){var a=this._conditions.subcriteria[this._conditions.subcriteria.length-1].id;this._subcriteriaLastIndex=parseInt(a.substring(a.lastIndexOf("-")+1))}this._logic=n.logic||null,this._scrollTo=n.scrollTo||!1,this._checks_out=!1,this._$element=null,this._bound=new Array,this._steps=new Array,this._sourceCriteria=r,this._selectTypeElementId="dgfw_criteria_choose_type_"+this._id,this._$selectTypeElement=null,this._elementData={tag:"div",id:"dgfw_criteria_"+this._id,classes:["dgfw-criteria"]},this._descriptionData={tag:"div",id:"dgfw_criteria_description_"+this._id,classes:["dgfw-criteria-description"]},this._types=new Map([["amounts",c.text("Amounts")],["items",c.text("Items")],["products",c.text("Products")],["product_categories",c.text("Product Categories")],["periods",c.text("Time Period")],["users",c.text("Users")],["user_roles",c.text("User Roles")]]),this._chooseTypeData={tag:"div",id:"dgfw_choose_type_wrap_"+this._id,classes:["dgfw-choose-type-container"],children:[{tag:"select",id:this._selectTypeElementId,classes:["dgfw-select-type"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][type]"},children:[]}]},this._types.forEach(function(e,t,i){var n={tag:"option",attributes:{value:t},text:e};s._type===t&&(n.attributes.selected="selected"),s._chooseTypeData.children[0].children.push(n)}),this._stepListContainerData={tag:"div",id:"dgfw_step_list_container_"+this._id,classes:["dgfw-criteria-step-list-container"],children:[]},this._stepListData={tag:"ul",id:"dgfw_step_list_"+this._id,classes:["dgfw-criteria-step-list","current-step-0"],children:[]},this._navigationData={tag:"div",id:"dgfw_criteria_nav_"+this._id,classes:["dgfw-criteria-nav"],children:[{tag:"button",id:"dgfw_prev_step_"+this._id,classes:["button","dgfw-button","dgfw-prev-step","dashicons-before","dashicons-arrow-left-alt"],text:c.text("Back"),attributes:{disabled:"disabled"}},{tag:"button",id:"dgfw_next_step_"+this._id,classes:["button","dgfw-button","dgfw-next-step","dashicons-after","dashicons-arrow-right-alt"],text:c.text("Next")}]},this._removeData={tag:"button",id:"dgfw_criteria_remove_"+this._id,classes:["dgfw-criteria-remove","dgfw-button","dashicons-before","dashicons-no"],text:c.text("Remove")};var o={tag:"button",id:"dgfw_add_and_"+this._id,classes:["button","dgfw-button","dgfw-add-and","dashicons-before","dashicons-warning"],text:c.text("AND")},d={tag:"button",id:"dgfw_add_or_"+this._id,classes:["button","dgfw-button","dgfw-add-or","dashicons-before","dashicons-editor-help"],text:c.text("OR")};this._andOrData={tag:"div",id:"dgfw_criteria_add_subcriteria_"+this._id,classes:["dgfw-subcriteria-add"],children:[]},this._logic?"OR"===this._logic?d.attributes={style:"display: none;"}:o.attributes={style:"display: none;"}:this._conditions.subcriteria&&this._conditions.subcriteria.length&&("OR"===this._conditions.subcriteria[0].logic?o.attributes={style:"display: none;"}:d.attributes={style:"display: none;"}),this._andOrData.children=[o,d],this._chooseTypeData.children.push({method:"chooseType",description:c.text("Choose condition type:"),elements:[{tag:"select",id:this._selectTypeElementId,classes:["dgfw-select-type"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][type]"},children:[]}]}),this._bindings=[{selector:"#dgfw_next_step_"+this._id,event:"click",object:this,method:"showNextStep"},{selector:"#dgfw_prev_step_"+this._id,event:"click",object:this,method:"showPrevStep"},{selector:"#dgfw_add_and_"+this._id,event:"click",object:this,method:"addSubcriteriaAnd"},{selector:"#dgfw_add_or_"+this._id,event:"click",object:this,method:"addSubcriteriaOr"},{selector:"#dgfw_criteria_remove_"+this._id,event:"click",object:this,method:"removeCriteria"},{selector:"#dgfw_criteria_remove_"+this._id,event:"mouseover",object:this,method:"addHighlight"},{selector:"#dgfw_criteria_remove_"+this._id,event:"mouseout",object:this,method:"removeHighlight"},{selector:".dgfw-step-description.has-help",event:"click",object:this,method:"toggleStepHelp"}],this.init()}return t(i,[{key:"init",value:function(){this.hideNavigation(),this._lastStep=this._steps.length-1,this._bindings.push({selector:"#"+this._selectTypeElementId,event:"change",object:this,method:"changeType"}),this.bind(),this._steps.length>1&&this.showNavigation()}},{key:"takeOverFromSource",value:function(){var e=this;this._currentStep=this._sourceCriteria._currentStep,this._subcriteria=this._sourceCriteria._subcriteria,this._subcriteriaLastIndex=this._sourceCriteria._subcriteriaLastIndex,this._logic=this._sourceCriteria._logic,this._checksOut=this._sourceCriteria._checksOut,this._$element=this._sourceCriteria._$element,this._$description=this._sourceCriteria._$description,this._$stepListContainer=this._sourceCriteria._$stepListContainer,this._sourceCriteria._$stepList.attr("id",this._sourceCriteria._$stepList.attr("id")+"_old"),this._$stepList=this.createAndAppendChild(this._$stepListContainer,this._stepListData),this._$navigation=this._sourceCriteria._$navigation,this._$andOr=this._sourceCriteria._$andOr,this._steps=this._sourceCriteria._steps,this._selectTypeElementId=this._sourceCriteria._selectTypeElementId,this._$selectTypeElement=this._sourceCriteria._$selectTypeElement,this._$removeButton=this._sourceCriteria._$removeButton,this._sourceCriteria._bound.forEach(function(e,t,i){e.unbind()}),this._subcriteria.forEach(function(t,i,s){e._bound.push(new a(e._$element,t.elementSelector(),t.changeTypeEvent(),e,"changeCriteriaType")),e._bound.push(new a(e._$element,t.elementSelector(),t.removeEvent(),e,"removeSubcriteria"))}),this._currentStep=0}},{key:"createElement",value:function(){var e=this;this._$element=jQuery(document.createElement(this._elementData.tag)),this._$element.attr("id",this._elementData.id),this._$element.addClass(this._elementData.classes.join(" ")),this._scrollTo&&this._$element.addClass("invisible"),this._elementData.children&&this._elementData.children.forEach(function(t,i,s){e.createAndAppendChild(e._$element,t)}),this._$description=this.createAndAppendChild(this._$element,this._descriptionData),this.createAndAppendChild(this._$element,this._chooseTypeData),this._$stepListContainer=this.createAndAppendChild(this._$element,this._stepListContainerData),this._$stepList=this.createAndAppendChild(this._$stepListContainer,this._stepListData),this._$navigation=this.createAndAppendChild(this._$element,this._navigationData),this._$removeButton=this.createAndAppendChild(this._$element,this._removeData),this._$andOr=this.createAndAppendChild(this._$element,this._andOrData),this.setElementDescription(c.text(this._logic||"First condition")),this._$element.addClass(this._logic?this._logic.toLowerCase():"first"),this._logic&&this.createAndAppendChild(this._$element,this.logicElement()),this.createAndAppendChild(this._$element,this.idElement()),this._scrollTo&&setTimeout(function(){e._$element.removeClass("invisible");var t=e._$element.offset().top;jQuery("html, body").animate({scrollTop:t-100},1e3)},10)}},{key:"logicElement",value:function(){return{tag:"input",id:"dgfw_criteria_logic_"+this._id,attributes:{type:"hidden",name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][logic]",value:this._logic}}}},{key:"idElement",value:function(){return{tag:"input",id:"dgfw_criteria_id_"+this._id,attributes:{type:"hidden",name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][id]",value:this._id}}}},{key:"createAndAppendChild",value:function(e,t){var i=this,s=jQuery(document.createElement(t.tag));if(s.attr("id",t.id),t.classes&&s.addClass(t.classes.join(" ")),t.attributes)for(var n in t.attributes)s.attr(n,t.attributes[n]);return t.text&&s.text(t.text),t.html&&s.html(t.html),e.append(s),t.children&&t.children.forEach(function(e,t,n){i.createAndAppendChild(s,e)}),s}},{key:"bind",value:function(){var e=this;this._bindings.forEach(function(t,i,s){e._bound.push(new a(e._$element,t.selector,t.event,t.object,t.method))})}},{key:"incrementStep",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._currentStep+=e,this._currentStep>this._lastStep&&(this._currentStep=this._lastStep),this._$stepList.find(".step-"+(this._currentStep-1)).removeClass("step-current").addClass("step-prev"),this._$stepList.find(".step-"+this._currentStep).addClass("step-current")}},{key:"decrementStep",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._currentStep-=e,this._currentStep<0&&(this._currentStep=0),this._$stepList.find(".step-"+(this._currentStep+1)).removeClass("step-current"),this._$stepList.find(".step-"+this._currentStep).removeClass("step-prev").addClass("step-current")}},{key:"showNextStep",value:function(){this.incrementStep(),r.info("next, to step:"+this._currentStep),this.currentStep()}},{key:"showPrevStep",value:function(){this.decrementStep(),r.info("prev, to step:"+this._currentStep),this.currentStep()}},{key:"currentStep",value:function(){if(this.readjustSize(),this._steps.length>1){var e=0===this._currentStep;this._$navigation.find("button.dgfw-prev-step").text(this.prevStepButtonText()).prop("disabled",e);var t=this._currentStep===this._lastStep;this._$navigation.find("button.dgfw-next-step").text(this.nextStepButtonText()).prop("disabled",t)}this._steps[this._currentStep].method&&this[this._steps[this._currentStep].method]()}},{key:"readjustSize",value:function(){this._$stepListContainer.height(this._$stepList.find("li.step-"+this._currentStep+" > .dgfw-criteria-step-wrapper").height()+70)}},{key:"id",value:function(){return this._id}},{key:"element",value:function(){return this._$element}},{key:"conditions",value:function(){return this._conditions}},{key:"elementSelector",value:function(){return"#"+this._elementData.id}},{key:"changeTypeEvent",value:function(){return"DGFW.CriteriaChangeType_"+this._id}},{key:"removeEvent",value:function(){return"DGFW.CriteriaRemove_"+this._id}},{key:"setElementDescription",value:function(e){this._$description.text(e)}},{key:"description",value:function(){var e=this._logic?c.text(this._logic):"";return e+=" "+this.generateDescription(),e}},{key:"generateDescription",value:function(){return this._type}},{key:"addSubcriteriaAnd",value:function(){this.addSubcriteria("AND"),this._$andOr.find("button.dgfw-add-or").hide()}},{key:"addSubcriteriaOr",value:function(){this.addSubcriteria("OR"),this._$andOr.find("button.dgfw-add-and").hide()}},{key:"addSubcriteria",value:function(e){var t=this._id+"-subcriteria-"+this.newSubcriteriaIndex(),i=I.createAndScrollTo(t,"amounts",{logic:e});this._subcriteria.set(t,i),this._$element.hasClass("first")&&this._$element.addClass(e.toLowerCase()),this.appendSubcriteriaElement(i.element()),this._bound.push(new a(this._$element,i.elementSelector(),i.changeTypeEvent(),this,"changeCriteriaType")),this._bound.push(new a(this._$element,i.elementSelector(),i.removeEvent(),this,"removeSubcriteria"))}},{key:"newSubcriteriaIndex",value:function(){return++this._subcriteriaLastIndex}},{key:"appendSubcriteriaElement",value:function(e){this._$andOr.before(e)}},{key:"chooseType",value:function(){r.info("choose type"),r.log(this),this._$navigation.find(".dgfw-prev-step").attr("disabled",!0)}},{key:"changeType",value:function(){this._$selectTypeElement=this._$selectTypeElement||jQuery(document.getElementById(this._selectTypeElementId)),this._type!==this._$selectTypeElement.val()&&(this._$element.trigger(this.changeTypeEvent(),[this._id.toString(),this._$selectTypeElement.val()]),r.info("change type to: "+this._$selectTypeElement.val()),r.log(this))}},{key:"changeCriteriaType",value:function(e,t,i){this._subcriteria.set(t,new I.createFrom(this._subcriteria.get(t),i))}},{key:"showType",value:function(){r.info("show type: "+this._type),r.log(this)}},{key:"stepElementsExist",value:function(e){return this._sourceCriteria&&this._sourceCriteria._steps[e]&&this._sourceCriteria._steps[e].elements}},{key:"removeStepElements",value:function(e){var t=this;this._sourceCriteria._steps[e].elements.forEach(function(i,s,n){r.info("Removed: "+i.id),jQuery(document.getElementById("dgfw_criteria_"+t._sourceCriteria.id()+"_step_"+e)).fadeOut().remove()})}},{key:"showNavigation",value:function(){this._$navigation.removeClass("invisible").find("button").prop("disabled",!1);var e=0===this._currentStep;this._$navigation.find("button.dgfw-prev-step").text(this.prevStepButtonText()).prop("disabled",e);var t=this._currentStep===this._lastStep;this._$navigation.find("button.dgfw-next-step").text(this.nextStepButtonText()).prop("disabled",t)}},{key:"hideNavigation",value:function(){this._$navigation.addClass("invisible").find("button").prop("disabled",!0)}},{key:"showCriteria",value:function(){var e=this;if(this._sourceCriteria||this.createElement(),this._steps.forEach(function(t,i,s){i<e._currentStep||(t.help&&t.elements.unshift({tag:"div",id:"dgfw_criteria_"+e._id+"_step"+i+"_help",classes:["dgfw-step-help"],html:t.help}),t.description&&t.elements.unshift({tag:"h4",id:"dgfw_criteria_"+e._id+"_step_"+i+"_description",classes:["dgfw-step-description",t.help?"has-help":""],text:t.description}),e.createAndAppendChild(e._$stepList,{tag:"li",id:"dgfw_criteria_"+e._id+"_step_"+i,classes:["dgfw-criteria-step","step-"+i,0===i?"step-current":""],children:[{tag:"div",id:"dgfw_criteria_"+e._id+"_step_wrapper"+i,classes:["dgfw-criteria-step-wrapper"],children:t.elements}]}))}),this._sourceCriteria){var t=this._sourceCriteria,i=this;setTimeout(function(){i._$stepListContainer.height(i._$stepList.find("li.step-0 > .dgfw-criteria-step-wrapper").height()+60),i._$stepListContainer.addClass("transition"),setTimeout(function(){t._$stepList.remove(),i._$stepListContainer.removeClass("transition"),i._sourceCriteria=!0},800)},100)}else setTimeout(function(){e.readjustSize()},10);this._conditions.subcriteria&&(this._conditions.subcriteria.forEach(function(t,i,s){var n=new I.create(t.id,t.type,t);e._subcriteria.set(t.id,n),e._$element.hasClass("first")&&e._$element.addClass(t.logic.toLowerCase()),e.appendSubcriteriaElement(n.element()),e._bound.push(new a(e._$element,n.elementSelector(),n.changeTypeEvent(),e,"changeCriteriaType")),e._bound.push(new a(e._$element,n.elementSelector(),n.removeEvent(),e,"removeSubcriteria"))}),this._conditions.subcriteria=void 0)}},{key:"removeElement",value:function(){var e=this;this._$element.css({height:this._$element.height()}),this._$element.slideUp(350,function(){e._$element.remove()})}},{key:"removeCriteria",value:function(){var e=this;confirm(c.text("Are you sure you want do remove this condition and all its child conditions?"))&&this._$element.animate({opacity:0},350,function(){e._$element.trigger(e.removeEvent(),[e._id.toString()])})}},{key:"addHighlight",value:function(){this._$element.addClass("highlight")}},{key:"removeHighlight",value:function(){this._$element.removeClass("highlight")}},{key:"removeSubcriteria",value:function(e,t){var i=this._subcriteria.get(t);this._subcriteria.delete(t),i.removeElement(),this.unbindSelector(i.elementSelector()),this._$element.hasClass("first")&&!this._subcriteria.size&&(this._$element.removeClass("and or"),this._$andOr.find("button").show())}},{key:"unbindSelector",value:function(e){var t=new Array;this._bound.forEach(function(i,s){i.selector()===e?i.unbind():t.push(i)}),this._bound=t}},{key:"prevStepButtonText",value:function(){var e;return e=this._currentStep>0?this._currentStep-1:this._currentStep,this._steps[e].stepName||c.text("Back")}},{key:"nextStepButtonText",value:function(){var e;return e=this._currentStep<this._lastStep?this._currentStep+1:this._currentStep,this._steps[e].stepName||c.text("Next")}},{key:"toggleStepHelp",value:function(e){var t=this,i=jQuery(e.currentTarget).siblings(".dgfw-step-help");i.is(":visible")?i.slideUp(185):i.slideDown(185),setTimeout(function(){t.readjustSize()},185)}}]),i}(),l=function(){function i(t,s){e(this,i),this._id=t,this._value,this._elements,this._inputElementId,this._$inputElement,this._options=s,this._bindings=new Array,this.init()}return t(i,[{key:"init",value:function(){}},{key:"hookElements",value:function(){this._$inputElement=this._$inputElement||jQuery(document.getElementById(this._inputElementId))}},{key:"elements",value:function(){return this._elements}},{key:"id",value:function(){return this._id}},{key:"elementId",value:function(){return this._inputElementId}},{key:"bindings",value:function(){return this._bindings}}]),i}(),h=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,l),t(a,[{key:"init",value:function(){this._currency=this._options.currency,this._label=this._options.label,this._inputElementId="dgfw_criteria_amount_"+this._id,this._currencyElementId="dgfw_criteria_amount_currency_"+this._id,this._prefixElementId="dgfw_criteria_amount_prefix_"+this._id,this._$prefixElement=null,this._value=this._options.value;var e={tag:"span",id:this._prefixElementId,classes:["dgfw-currency","dgfw-currency-amount"],text:this._currency.symbol};this._elements=[{tag:"label",id:"dgfw_criteria_amount_label_"+this._id,classes:["dgfw-label","dgfw-label-amount"],text:this._label,attributes:{for:this._inputElementId}}],"left"!==this._currency.position&&"left_space"!==this._currency.position||(e.classes.push("left"),this._elements.push(e)),this._elements.push({tag:"input",id:this._inputElementId,classes:["dgfw-amount"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]",type:"number",step:"0.01",value:this._value}}),"right"!==this._currency.position&&"right_space"!==this._currency.position||(e.classes.push("right"),this._elements.push(e)),this._elements.push({tag:"input",id:this._currencyElementId,classes:["dgfw-amount"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][currency]",type:"hidden",value:this._currency.text}}),i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}},{key:"hookElements",value:function(){i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"hookElements",this).call(this),this._$prefixElement=this._$prefixElement||jQuery(document.getElementById(this._prefixElementId)),this._$currencyElement=this._$currencyElement||jQuery(document.getElementById(this._currencyElementId))}},{key:"changeCurrencyTo",value:function(e){this.hookElements(),this._currency.position!==e.position&&("left"===e.position||"left_space"===e.position?this._$prefixElement.removeClass("right").addClass("left").insertBefore(this._$inputElement):this._$prefixElement.removeClass("left").addClass("right").insertAfter(this._$inputElement)),this._currency=e,this._$prefixElement.text(this._currency.symbol),this._$currencyElement.val(this._currency.text)}},{key:"validate",value:function(){this.hookElements();var e=parseFloat(this._$inputElement.val());return this._value=e,!0,this.format(),!0}},{key:"value",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e&&(this._value=parseFloat(e),this.format()),this._value}},{key:"setMin",value:function(e){this.hookElements(),this._minValue=parseFloat(e),this._$inputElement.attr("min",this._minValue),this._minValue>this._value&&this.value(this._minValue)}},{key:"setMax",value:function(e){this.hookElements(),this._maxValue=parseFloat(e),this._$inputElement.attr("max",this._maxValue),this._maxValue<this._value&&this.value(this._maxValue)}},{key:"format",value:function(){this.hookElements();var e=this._value.toFixed(Math.max(0,2)).replace(new RegExp("\\d(?=(\\d{999})+\\.)","g"),"$&,");this._$inputElement.val(e)}}]),a}(),u=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,d),t(a,[{key:"init",value:function(){var e=this;this._type="amounts",this._sourceCriteria&&this.takeOverFromSource(),this._currencies=decomGiftable.screen.data.currencies,this._conditions.min_amount&&this._conditions.min_amount.currency?this._currency=this.getCurrency(this._conditions.min_amount.currency):this._currency=this.getDefaultCurrency(),this._currencySelectId="dgfw_criteria_currency_"+this._id,this._$currencySelect=null;var t=[];this._currencies.length&&this._currencies.forEach(function(i,s,n){t.push({tag:"option",attributes:{value:i.text,selected:i.text===e._currency.text&&"selected"},text:i.text})}),this._minAmount=new h(this._id+"-min_amount",{currency:this._currency,label:c.text("Min amount"),value:this._conditions.min_amount?this._conditions.min_amount.value:0}),this._maxAmount=new h(this._id+"-max_amount",{currency:this._currency,label:c.text("Max amount"),value:this._conditions.max_amount?this._conditions.max_amount.value:0}),this._steps=new Array,this._steps[0]={description:c.text("Set amount range. Leave empty for no limits."),help:c.text("This condition will be met if the <strong>total cart amount</strong> is within the defined min/max amounts range."),elements:[{tag:"div",id:"dgfw_criteria_amounts_min_container_"+this._id,classes:["dgfw-criteria-input-container"],children:this._minAmount.elements()},{tag:"div",id:"dgfw_criteria_amounts_max_container_"+this._id,classes:["dgfw-criteria-input-container"],children:this._maxAmount.elements()}]},t.length&&(this._steps[0].elements.unshift({tag:"div",id:"dgfw_criteria_amounts_currency_container_"+this._id,classes:["dgfw-criteria-input-container"],children:[{tag:"label",id:"dgfw_criteria_currency_label_"+this._id,classes:["dgfw-label","dgfw-label-amount"],text:c.text("Currency"),attributes:{for:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][currency]"}},{tag:"select",id:this._currencySelectId,classes:["dgfw-currency","dgfw-select"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][currency]"},children:t}]}),this._steps[0].elements.push({tag:"div",id:"dgfw_criteria_amounts_currency_note_"+this._id,classes:["dgfw-step-description","dgfw-step-note"],html:c.text('<strong>Multi-currency Note</strong>: This condition can be met only by customers shopping in the selected currency. You can cover other currencies by adding another "OR" Amount condition with appropriate min/max amounts for each enabled currency.')})),this.showCriteria(),this._bindings.push({selector:"#"+this._currencySelectId,event:"change",object:this,method:"changeCurrency"},{selector:"#"+this._minAmount.elementId(),event:"focusout",object:this,method:"updateMinAmount"},{selector:"#"+this._maxAmount.elementId(),event:"focusout",object:this,method:"updateMaxAmount"}),i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}},{key:"getCurrency",value:function(e){if(!this._currencies)return decomGiftable.screen.data.currency||!1;for(var t=this._currencies.length,i=!1,s=0;s<t;s++)if(this._currencies[s].text===e){i=this._currencies[s];break}return i||(i=decomGiftable.screen.data.currency),i}},{key:"getDefaultCurrency",value:function(){return this._currencies&&this._currencies.length?this._currencies[0]:decomGiftable.screen.data.currency}},{key:"changeCurrency",value:function(){this._$currencySelect||(this._$currencySelect=jQuery(document.getElementById(this._currencySelectId)));var e=this.getCurrency(this._$currencySelect.val());e&&e.text!==this._currency.text&&(this._currency=e,this._minAmount.changeCurrencyTo(this._currency),this._maxAmount.changeCurrencyTo(this._currency))}},{key:"updateMinAmount",value:function(){this._minAmount.validate()}},{key:"updateMaxAmount",value:function(){this._maxAmount.validate()}}]),a}(),_=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,l),t(a,[{key:"init",value:function(){this._label=this._options.label,this._inputElementId="dgfw_criteria_items_"+this._id,this._value=this._options.value,this._elements=[{tag:"label",id:"dgfw_criteria_items_label_"+this._id,classes:["dgfw-label","dgfw-label-items"],text:this._label,attributes:{for:this._inputElementId}},{tag:"input",id:this._inputElementId,classes:["dgfw-items"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]",type:"number",step:"1",value:this._value}}],i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}},{key:"validate",value:function(){this.hookElements();var e=parseFloat(this._$inputElement.val()),t=!1;return e>=this._minValue&&e<=this._maxValue&&(this._value=e,t=!0),this.format(),t}},{key:"value",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e&&(this._value=parseFloat(e),this.format()),this._value}},{key:"setMin",value:function(e){this.hookElements(),this._minValue=parseFloat(e),this._$inputElement.attr("min",this._minValue),this._minValue>this._value&&this.value(this._minValue)}},{key:"setMax",value:function(e){this.hookElements(),this._maxValue=parseFloat(e),this._$inputElement.attr("max",this._maxValue),this._maxValue<this._value&&this.value(this._maxValue)}},{key:"format",value:function(){this.hookElements();var e=this._value.toFixed(Math.max(0,0)).replace(new RegExp("\\d(?=(\\d{3})+$)","g"),"$&,");this._$inputElement.val(e)}}]),a}(),p=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,d),t(a,[{key:"init",value:function(){this._type="items",this._sourceCriteria&&this.takeOverFromSource(),this._minItems=new _(this._id+"-min_items",{label:c.text("Min items"),value:this._conditions.min_items?this._conditions.min_items.value:0}),this._maxItems=new _(this._id+"-max_items",{label:c.text("Max items"),value:this._conditions.max_items?this._conditions.max_items.value:0}),this._steps=new Array,this._steps[0]={description:c.text("Set items range. Leave empty for no limits."),help:c.text("This condition will be met if the <strong>total number of items in the cart</strong> is within the defined min/max items range."),elements:[{tag:"div",id:"dgfw_criteria_items_min_container_"+this._id,classes:["dgfw-criteria-input-container"],children:this._minItems.elements()},{tag:"div",id:"dgfw_criteria_items_max_container_"+this._id,classes:["dgfw-criteria-input-container"],children:this._maxItems.elements()}]},this.showCriteria(),i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}},{key:"updateMinItems",value:function(){this._minItems.validate()&&(this._maxItems.setMin(this._minItems.value()),this._minItems.value()>this._maxItems.value()&&this._maxItems.value(this._minItems.value()))}},{key:"updateMaxItems",value:function(){this._maxItems.validate()&&this._minItems.setMax(this._maxItems.value())}}]),a}(),m=function(a){function o(){return e(this,o),n(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return s(o,l),t(o,[{key:"init",value:function(){var e=this;this._postType=this._options.postType,this._label=this._options.label,this._inputElementId="dgfw_criteria_posts_"+this._id,this._containerId="dgfw_critera_posts_select_"+this._id,this._selectedListId="dgfw_criteria_posts_"+this._id+"_selected_list",this._advancedContainerId="dgfw_criteria_posts_advanced_settings_"+this._id,this._advancedListId="dgfw_criteria_posts_"+this._id+"_advanced_list",this._navPrevId="dgfw_criteria_posts_select_nav_prev_"+this._id,this._navNextId="dgfw_criteria_posts_select_nav_next_"+this._id,this._statusCurrentPageId="dgfw_criteria_posts_select_nav_status_current_"+this._id,this._statusTotalPagesId="dgfw_criteria_posts_select_nav_status_total_"+this._id,this._value=new Object,this._options.value&&(this._value=this._options.value),this._currentPage=0,this._totalProducts=0,this._totalPages=1,this._productsPerPage=jQuery(window).width()>1023?5:3;var t=new Array;decomGiftable.screen.data.products&&(this._totalProducts=decomGiftable.screen.data.products.length,this._totalPages=Math.ceil(this._totalProducts/this._productsPerPage),decomGiftable.screen.data.products.forEach(function(i,s,n){t[Math.floor(s/e._productsPerPage)]=t[Math.floor(s/e._productsPerPage)]||new Array,t[Math.floor(s/e._productsPerPage)].push(e.productElement(i))}));var s=new Array;t.forEach(function(t,i,n){s[i]={tag:"div",id:e._containerId+"_page_"+i,classes:["dgfw-select-posts-container-page","page-"+i,0===i?"page-current":""],children:t}});var n={tag:"div",id:this._selectedListId,classes:["dgfw-selected-posts"],children:[]},r={tag:"div",id:this._advancedListId,classes:["dgfw-advanced-posts"],children:[]};if(Object.keys(this._value).length)for(var a in this._value){var d=this.post(parseInt(a));this._value[a]&&d&&(n.children.push(this.selectedProductElement(d,!1)),r.children.push(this.advancedProductElement(d,this._value[a])))}else n.classes.push("invisible");this._elements=[n,{tag:"div",id:this._containerId,classes:["dgfw-select-wrapper","dgfw-select-posts","current-page-0"],children:s},{tag:"input",id:this._inputElementId,classes:["dgfw-products"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]",type:"hidden",value:Object.keys(this._value).join(",")}},{tag:"input",id:this._inputElementId+"_post_types",classes:["dgfw-products"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][post_types][]",type:"hidden",value:this._postType}}],this._totalPages>1&&this._elements.splice(1,0,{tag:"div",id:"dgfw_criteria_posts_select_nav_"+this._id,classes:["dgfw-select-posts-nav"],children:[{tag:"button",id:this._navPrevId,classes:["dgfw-select-posts-nav-prev","button","dgfw-button-secondary","dashicons-before","dashicons-arrow-left"]},{tag:"span",id:"dgfw_criteria_select_nav_status_"+this._id,classes:["dgfw-select-posts-nav-status"],children:[{tag:"span",id:"",classes:[],text:c.text("Page ")},{tag:"span",id:this._statusCurrentPageId,classes:["dgfw-select-posts-nav-status-number"],text:this._currentPage+1},{tag:"span",id:"",classes:[],text:c.text(" of ")},{tag:"span",id:this._statusTotalPagesId,classes:["dgfw-select-posts-nav-status-number"],text:this._totalPages}]},{tag:"button",id:this._navNextId,classes:["dgfw-select-posts-nav-prev","button","dgfw-button-secondary","dashicons-before","dashicons-arrow-right"]}]}),this._advancedElements=[{tag:"div",id:this._advancedContainerId,classes:["dgfw-advanced-wrapper"],children:[r]}],this._bindings.push({selector:"#"+this._containerId,event:"mouseover",object:this,method:"loadNextPage"},{selector:"#"+this._navPrevId,event:"click",object:this,method:"previousPage"},{selector:"#"+this._navNextId,event:"click",object:this,method:"nextPage"},{selector:".dgfw-posts-select-post",event:"click",object:this,method:"toggleSelectPost"},{selector:".dgfw-posts-selected-remove",event:"click",object:this,method:"removeSelectedPost"}),i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"init",this).call(this)}},{key:"hookElements",value:function(){i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"hookElements",this).call(this),this._$containerElement=this._$containerElement||jQuery(document.getElementById(this._containerId)),this._$selectedListElement=this._$selectedListElement||jQuery(document.getElementById(this._selectedListId)),this._$currentPageStatus=this._$currentPageStatus||jQuery(document.getElementById(this._statusCurrentPageId)),this._$advancedListElement=this._$advancedListElement||jQuery(document.getElementById(this._advancedListId))}},{key:"containerId",value:function(){return this._containerId}},{key:"loadNextPage",value:function(){this.hookElements(),r.info("Loading more products...")}},{key:"productElement",value:function(e){var t=["dgfw-posts-select-post"];return this._value[e.id]&&t.push("selected"),{tag:"div",id:"dgfw_criteria_posts_"+this._id+"_product_"+e.id,classes:t,attributes:{"data-decom-id":e.id},children:[{tag:"h4",classes:["dgfw-posts-select-post-title"],text:e.title.length<30?e.title:e.title.slice(0,30)+"…"},{tag:"div",classes:["dgfw-posts-select-post-img"],attributes:{style:"background-image: url("+e.img+");"}}]}}},{key:"selectedProductElement",value:function(e){var t=["dgfw-posts-selected-post"];return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&t.push("invisible"),{tag:"div",id:"dgfw_criteria_posts_"+this._id+"_selected_"+e.id,classes:t,attributes:{"data-decom-id":e.id},children:[{tag:"h4",classes:["dgfw-posts-select-post-title"],text:e.title.length<30?e.title:e.title.slice(0,30)+"…"},{tag:"div",classes:["dgfw-posts-select-post-img"],attributes:{style:"background-image: url("+e.img+");"}},{tag:"span",id:"dgfw_criteria_posts_selected_remove_"+e.id,classes:["dgfw-posts-selected-remove","dashicons-before","dashicons-no"],attributes:{"data-decom-id":e.id}}]}}},{key:"advancedProductMinItemsInputId",value:function(e){return"dgfw_criteria_posts_advanced_min_items_"+e}},{key:"advancedProductElement",value:function(e,t){var i=["dgfw-posts-advanced-post"],s=this.advancedProductMinItemsInputId(e.id);return{tag:"div",id:"dgfw_criteria_posts_"+this._id+"_advanced_"+e.id,classes:i,attributes:{"data-decom-id":e.id},children:[{tag:"h4",classes:["dgfw-posts-select-post-title"],text:e.title.length<20?e.title:e.title.slice(0,40)+"…"},{tag:"div",classes:["dgfw-posts-select-post-img"],attributes:{style:"background-image: url("+e.img+");"}},{tag:"span",id:"dgfw_criteria_posts_advanced_remove_"+e.id,classes:["dgfw-posts-selected-remove","dashicons-before","dashicons-no"],attributes:{"data-decom-id":e.id}},{tag:"input",id:s,classes:["dgfw-posts-advanced-min-items"],attributes:{type:"number",name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]["+e.id+"][min_items]",value:t.min_items}}]}}},{key:"toggleSelectPost",value:function(e){this.hookElements();var t=jQuery(e.currentTarget),i=parseInt(t.data("decom-id"));t.toggleClass("selected"),this._value[i]?(delete this._value[i],this.removeFromList(i)):(this._value[i]={min_items:1},this.addToList(i)),this._$inputElement.val(Object.getOwnPropertyNames(this._value).join(","))}},{key:"removeSelectedPost",value:function(e){this.hookElements();var t=jQuery(e.currentTarget),i=parseInt(t.data("decom-id"));(t=jQuery("#dgfw_criteria_posts_"+this._id+"_product_"+i)).removeClass("selected"),this._value[i]&&(delete this._value[i],this.removeFromList(i))}},{key:"addToList",value:function(e){var t=this,i=this.post(e);this.createAndAppendChild(this._$selectedListElement,this.selectedProductElement(i)),this.createAndAppendChild(this._$advancedListElement,this.advancedProductElement(i,{min_items:1})),setTimeout(function(){t._$selectedListElement.removeClass("invisible"),t.$postElement(e).removeClass("invisible"),setTimeout(function(){t.selectionChanged()},200)},50)}},{key:"removeFromList",value:function(e){var t=this,i=this.$postElement(e),s=this.$advancedPostElement(e);i.addClass("invisible"),setTimeout(function(){0===Object.keys(t._value).length&&t._$selectedListElement.addClass("invisible"),i.remove(),s.remove(),setTimeout(function(){t.selectionChanged()},200)},50)}},{key:"selectionChangedEvent",value:function(){return"DGFW.SelectionChanged_"+this._id}},{key:"selectionChanged",value:function(){this._$inputElement.trigger(this.selectionChangedEvent())}},{key:"post",value:function(e){var t=!1;return decomGiftable.screen.data.products.forEach(function(i,s,n){i.id===e&&(t=i)}),t}},{key:"$postElement",value:function(e){return jQuery(document.getElementById("dgfw_criteria_posts_"+this._id+"_selected_"+e))}},{key:"$advancedPostElement",value:function(e){return jQuery(document.getElementById("dgfw_criteria_posts_"+this._id+"_advanced_"+e))}},{key:"createAndAppendChild",value:function(e,t){var i=this,s=jQuery(document.createElement(t.tag));if(s.attr("id",t.id),t.classes&&s.addClass(t.classes.join(" ")),t.attributes)for(var n in t.attributes)s.attr(n,t.attributes[n]);return t.text&&s.text(t.text),e.append(s),t.children&&t.children.forEach(function(e,t,n){i.createAndAppendChild(s,e)}),s}},{key:"previousPage",value:function(){this.hookElements(),this._currentPage-=this._currentPage>0?1:0,this._$containerElement.find(".page-"+(this._currentPage+1)).removeClass("page-current"),this._$containerElement.find(".page-"+this._currentPage).removeClass("page-prev").addClass("page-current"),this.updateCurrentPageStatus()}},{key:"nextPage",value:function(){this.hookElements(),this._currentPage+=this._currentPage<this._totalPages-1?1:0,this._$containerElement.find(".page-"+(this._currentPage-1)).removeClass("page-current").addClass("page-prev"),this._$containerElement.find(".page-"+this._currentPage).addClass("page-current"),this.updateCurrentPageStatus()}},{key:"updateCurrentPageStatus",value:function(){this.hookElements(),this._$currentPageStatus.text(this._currentPage+1)}},{key:"advancedElements",value:function(){return this._advancedElements}}]),o}(),g=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,d),t(a,[{key:"init",value:function(){this._type="products",this._sourceCriteria&&this.takeOverFromSource(),this._products=new m(this._id+"-posts",{label:c.text("Posts"),postType:"product",value:!!this._conditions.posts&&this._conditions.posts.value}),this._steps=new Array;var e=this._products.elements(),t=this._products.advancedElements();this._steps[0]={stepName:c.text("Select Products"),description:c.text("Select products this gift category applies for."),help:c.text("This condition will be met if the customer has at least one item of any of the selected products in their cart. To specify a minimum quantity for each selected product, click the <strong>Product Quantities</strong> button below."),elements:[{tag:"div",id:"dgfw_criteria_products_container_"+this._id,classes:["dgfw-criteria-input-container"],children:e}]},this._steps[1]={stepName:c.text("Product Quantities"),description:c.text("Set minimum quantity for each selected product."),elements:[{tag:"div",id:"dgfw_criteria_products_advanced_"+this._id,classes:["dgfw-criteria-input-container"],children:t}]},this.showCriteria(),this._bindings=this._bindings.concat(this._products.bindings()),this._bindings.push({selector:"#"+this._products.elementId(),event:this._products.selectionChangedEvent(),object:this,method:"readjustSize"}),i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}}]),a}(),f=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,l),t(a,[{key:"init",value:function(){var e=this;this._taxonomy=this._options.taxonomy,this._label=this._options.label,this._value=this._options.terms.value||new Array,this._minAmounts=this._options.terms.min_amounts||new Object,this._minItems=this._options.terms.min_items||new Object,this._inputElementId="dgfw_criteria_terms_"+this._id,this._inputElementName="dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]",this._termsMeta=new Object,this._currency=this._options.currency,this._advancedContainerId="dgfw_criteria_terms_advanced_settings_"+this._id,this._advancedListId="dgfw_criteria_terms_"+this._id+"_advanced_list";var t=new Array,s={tag:"div",id:this._advancedListId,classes:["dgfw-advanced-posts"],children:[]};decomGiftable.screen.data.productCategories&&decomGiftable.screen.data.productCategories.forEach(function(i,s,n){t.push(e.termElement(i))}),this._elements=[{tag:"div",id:"dgfw_select_terms_"+this._id,classes:["dgfw-checkbox-group-wrapper"],children:t},{tag:"input",id:this._inputElementId+"_taxonomy",classes:["dgfw-products"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][taxonomy]",type:"hidden",value:this._taxonomy}}],this._value.length&&this._value.forEach(function(t,i){var n=e.productCategory(parseInt(t));n&&s.children.push(e.advancedProductCategoryElement(n,t))}),this._advancedElements=[{tag:"div",id:this._advancedContainerId,classes:["dgfw-advanced-wrapper"],children:[s]}],this._bindings.push({selector:".dgfw-terms-select-checkbox",event:"change",object:this,method:"toggleSelectTerm"},{selector:".dgfw-posts-selected-remove",event:"click",object:this,method:"removeSelectedTerm"}),i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}},{key:"advancedListId",value:function(){return this._advancedListId}},{key:"hookElements",value:function(){i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"hookElements",this).call(this),this._$advancedListElement=this._$advancedListElement||jQuery(document.getElementById(this._advancedListId))}},{key:"termElement",value:function(e){var t={type:"checkbox",name:this._inputElementName+"[]",value:e.id};return this._value.forEach(function(i,s,n){parseInt(i)===e.id&&(t.checked="checked")}),{tag:"div",id:"dgfw_criteria_terms_"+this._id+"_term_"+e.id,classes:["dgfw-terms-select"],attributes:{"data-decom-id":e.id},children:[{tag:"input",id:"dgfw_terms_select_"+this._id+"_checkbox_"+e.id,classes:["dgfw-terms-select-checkbox"],attributes:t},{tag:"label",classes:["dgfw-terms-select-label"],text:e.title,attributes:{for:"dgfw_terms_select_"+this._id+"_checkbox_"+e.id}}]}}},{key:"productCategory",value:function(e){var t=!1;return decomGiftable.screen.data.productCategories.forEach(function(i,s,n){i.id===e&&(t=i)}),t}},{key:"advancedProductCategoryElement",value:function(e,t){var i=["dgfw-posts-advanced-post","dgfw-terms-advanced-term"],s=this._id+"-min_amounts-"+e.id,n=this._minAmounts[e.id]?this._minAmounts[e.id].value:0,r=this._id+"-min_items-"+e.id,a=this._minItems[e.id]?this._minItems[e.id].value:1;return this._termsMeta[e.id]={minAmount:new h(s,{currency:this._currency,label:c.text("Min amount"),value:n}),minItems:new _(r,{label:c.text("Min items"),value:a})},{tag:"div",id:"dgfw_criteria_posts_"+this._id+"_advanced_"+e.id,classes:i,attributes:{"data-decom-id":e.id},children:[{tag:"h4",classes:["dgfw-posts-select-post-title"],text:e.title.length<20?e.title:e.title.slice(0,40)+"…"},{tag:"span",id:"dgfw_criteria_posts_advanced_remove_"+e.id,classes:["dgfw-posts-selected-remove","dashicons-before","dashicons-no"],attributes:{"data-decom-id":e.id}},{tag:"div",id:"dgfw_criteria_posts_advanced_options_"+e.id,classes:["dgfw-terms-advanced-options"],children:[{tag:"div",id:s+"_container",classes:["dgfw-terms-advanced-min-amount"],children:this._termsMeta[e.id].minAmount.elements()},{tag:"div",id:r+"_container",classes:["dgfw-terms-advanced-min-items"],children:this._termsMeta[e.id].minItems.elements()}]}]}}},{key:"advancedElements",value:function(){return this._advancedElements}},{key:"toggleSelectTerm",value:function(e){this.hookElements();var t=jQuery(e.currentTarget),i=parseInt(t.val());t.is(":checked")?this.addToList(i):this.removeFromList(i)}},{key:"removeSelectedTerm",value:function(e){this.hookElements();var t=jQuery(e.currentTarget),i=parseInt(t.data("decom-id")),s=jQuery(document.getElementById("dgfw_terms_select_"+this._id+"_checkbox_"+i));this.removeFromList(i),s.prop("checked",!1)}},{key:"addToList",value:function(e){var t=this.productCategory(e);this.createAndAppendChild(this._$advancedListElement,this.advancedProductCategoryElement(t))}},{key:"removeFromList",value:function(e){this.$advancedTermElement(e).remove(),delete this._termsMeta[e],this.selectionChanged()}},{key:"$advancedTermElement",value:function(e){return jQuery(document.getElementById("dgfw_criteria_posts_"+this._id+"_advanced_"+e))}},{key:"createAndAppendChild",value:function(e,t){var i=this,s=jQuery(document.createElement(t.tag));if(s.attr("id",t.id),t.classes&&s.addClass(t.classes.join(" ")),t.attributes)for(var n in t.attributes)s.attr(n,t.attributes[n]);return t.text&&s.text(t.text),e.append(s),t.children&&t.children.forEach(function(e,t,n){i.createAndAppendChild(s,e)}),s}},{key:"selectionChangedEvent",value:function(){return"DGFW.SelectionChanged_"+this._id}},{key:"selectionChanged",value:function(){this._$advancedListElement.trigger(this.selectionChangedEvent())}},{key:"changeCurrencyTo",value:function(e){this._currency=e;for(var t in this._termsMeta)this._termsMeta[t].minAmount.changeCurrencyTo(this._currency)}}]),a}(),v=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,d),t(a,[{key:"init",value:function(){var e=this;this._type="product_categories",this._sourceCriteria&&this.takeOverFromSource(),this._currencies=decomGiftable.screen.data.currencies,this._conditions.currency&&this._conditions.currency?this._currency=this.getCurrency(this._conditions.currency):this._currency=this.getDefaultCurrency(),this._terms=new f(this._id+"-terms",{label:c.text("Terms"),taxonomy:"product_cat",terms:!!this._conditions.terms&&this._conditions.terms,currency:this._currency}),this._currencySelectId="dgfw_criteria_currency_"+this._id,this._$currencySelect=null;var t=[];this._currencies.length&&this._currencies.forEach(function(i,s,n){t.push({tag:"option",attributes:{value:i.text,selected:i.text===e._currency.text&&"selected"},text:i.text})}),this._steps=new Array,this._steps[0]={stepName:c.text("Select Product Categories"),description:c.text("Select product categories this gift category applies for."),help:c.text("This condition will be met if the customer has at least one product belonging to any of the selected product categories in their cart. To specify minimum amounts and/or items for each selected category, click the <strong>Amounts and Quantities</strong> button below."),elements:[{tag:"div",id:"dgfw_criteria_product_cats_container_"+this._id,classes:["dgfw-criteria-input-container"],children:this._terms.elements()}]},this._steps[1]={stepName:c.text("Amounts and Quantities"),description:c.text("Set up the minimum amount and/or number of items for each selected category."),help:c.text("By default, this condition will be met if the customer has at least one product belonging to any of the selected product categories in their cart. You can change minimum amount and/or items for each selected category here. Leave the fields empty for default value (one item minimum, regardless of the amount)."),elements:[{tag:"div",id:"dgfw_criteria_product_cats_advanced_"+this._id,classes:["dgfw-criteria-input-container"],children:this._terms.advancedElements()}]},t.length&&(this._steps[1].elements.unshift({tag:"div",id:"dgfw_criteria_terms_currency_container_"+this._id,classes:["dgfw-criteria-input-container","dgfw-criteria-terms-currency-select-container"],children:[{tag:"label",id:"dgfw_criteria_currency_label_"+this._id,classes:["dgfw-label","dgfw-label-amount"],text:c.text("Currency"),attributes:{for:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][currency]"}},{tag:"select",id:this._currencySelectId,classes:["dgfw-currency","dgfw-select"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][currency]"},children:t}]}),this._steps[1].elements.push({tag:"div",id:"dgfw_criteria_terms_currency_note_"+this._id,classes:["dgfw-step-description","dgfw-step-note"],html:c.text('<strong>Multi-currency Note</strong>: This condition can be met only by customers shopping in the selected currency. You can cover other currencies by adding another "OR" Amount condition with appropriate min/max amounts for each enabled currency.')})),this.showCriteria(),this._bindings=this._bindings.concat(this._terms.bindings()),this._bindings.push({selector:"#"+this._currencySelectId,event:"change",object:this,method:"changeCurrency"},{selector:"#"+this._terms.advancedListId(),event:this._terms.selectionChangedEvent(),object:this,method:"readjustSize"}),i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}},{key:"getCurrency",value:function(e){if(!this._currencies)return decomGiftable.screen.data.currency||!1;for(var t=this._currencies.length,i=!1,s=0;s<t;s++)if(this._currencies[s].text===e){i=this._currencies[s];break}return i||(i=decomGiftable.screen.data.currency),i}},{key:"getDefaultCurrency",value:function(){return this._currencies&&this._currencies.length?this._currencies[0]:decomGiftable.screen.data.currency}},{key:"changeCurrency",value:function(){this._$currencySelect||(this._$currencySelect=jQuery(document.getElementById(this._currencySelectId)));var e=this.getCurrency(this._$currencySelect.val());e&&e.text!==this._currency.text&&(this._currency=e,this._terms.changeCurrencyTo(this._currency))}}]),a}(),y=function(a){function o(){return e(this,o),n(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return s(o,l),t(o,[{key:"init",value:function(){var e=this;this._label=this._options.label,this._inputElementId="dgfw_criteria_users_"+this._id,this._containerId="dgfw_critera_users_select_"+this._id,this._selectedListId="dgfw_criteria_users_"+this._id+"_selected_list",this._navPrevId="dgfw_criteria_users_select_nav_prev_"+this._id,this._navNextId="dgfw_criteria_users_select_nav_next_"+this._id,this._statusCurrentPageId="dgfw_criteria_users_select_nav_status_current_"+this._id,this._statusTotalPagesId="dgfw_criteria_users_select_nav_status_total_"+this._id,this._value=new Object,this._options.value&&this._options.value.split(",").forEach(function(t){parseInt(t)&&(e._value[t]=t)}),this._currentPage=0,this._totalUsers=0,this._totalPages=1,this._usersPerPage=5;var t=new Array;decomGiftable.screen.data.users&&(this._totalUsers=decomGiftable.screen.data.users.length,this._totalPages=Math.ceil(this._totalUsers/this._usersPerPage),decomGiftable.screen.data.users.forEach(function(i,s,n){t[Math.floor(s/e._usersPerPage)]=t[Math.floor(s/e._usersPerPage)]||new Array,t[Math.floor(s/e._usersPerPage)].push(e.userElement(i))}));var s=new Array;t.forEach(function(t,i,n){s[i]={tag:"div",id:e._containerId+"_page_"+i,classes:["dgfw-select-users-container-page","page-"+i,0===i?"page-current":""],children:t}});var n={tag:"div",id:this._selectedListId,classes:["dgfw-selected-users"],children:[]};if(Object.keys(this._value).length)for(var r in this._value){var a=this.user(parseInt(r));this._value[r]&&a&&n.children.push(this.selectedUserElement(a,!1))}else n.classes.push("invisible");this._elements=[n,{tag:"div",id:this._containerId,classes:["dgfw-select-wrapper","dgfw-select-users","current-page-0"],children:s},{tag:"input",id:this._inputElementId,classes:["dgfw-users"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]",type:"hidden",value:Object.keys(this._value).join(",")}}],this._totalPages>1&&this._elements.splice(1,0,{tag:"div",id:"dgfw_criteria_users_select_nav_"+this._id,classes:["dgfw-select-users-nav"],children:[{tag:"button",id:this._navPrevId,classes:["dgfw-select-users-nav-prev","button","dgfw-button-secondary","dashicons-before","dashicons-arrow-left"]},{tag:"span",id:"dgfw_criteria_select_nav_status_"+this._id,classes:["dgfw-select-users-nav-status"],children:[{tag:"span",id:"",classes:[],text:c.text("Page ")},{tag:"span",id:this._statusCurrentPageId,classes:["dgfw-select-users-nav-status-number"],text:this._currentPage+1},{tag:"span",id:"",classes:[],text:c.text(" of ")},{tag:"span",id:this._statusTotalPagesId,classes:["dgfw-select-users-nav-status-number"],text:this._totalPages}]},{tag:"button",id:this._navNextId,classes:["dgfw-select-users-nav-prev","button","dgfw-button-secondary","dashicons-before","dashicons-arrow-right"]}]}),this._bindings.push({selector:"#"+this._containerId,event:"mouseover",object:this,method:"loadNextPage"},{selector:"#"+this._navPrevId,event:"click",object:this,method:"previousPage"},{selector:"#"+this._navNextId,event:"click",object:this,method:"nextPage"},{selector:".dgfw-users-select-user",event:"click",object:this,method:"toggleSelectUser"},{selector:".dgfw-users-selected-remove",event:"click",object:this,method:"removeSelectedUser"}),i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"init",this).call(this)}},{key:"hookElements",value:function(){i(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"hookElements",this).call(this),this._$containerElement=this._$containerElement||jQuery(document.getElementById(this._containerId)),this._$selectedListElement=this._$selectedListElement||jQuery(document.getElementById(this._selectedListId)),this._$currentPageStatus=this._$currentPageStatus||jQuery(document.getElementById(this._statusCurrentPageId))}},{key:"containerId",value:function(){return this._containerId}},{key:"loadNextPage",value:function(){this.hookElements(),r.info("Loading more users...")}},{key:"userElement",value:function(e){var t=["dgfw-users-select-user"];return this._value[e.id]&&t.push("selected"),{tag:"div",id:"dgfw_criteria_users_"+this._id+"_user_"+e.id,classes:t,attributes:{"data-decom-id":e.id},children:[{tag:"h4",classes:["dgfw-users-select-user-name"],text:e.displayName.length<30?e.displayName:e.displayName.slice(0,30)+"…"},{tag:"div",classes:["dgfw-users-select-user-img"],attributes:{style:"background-image: url("+e.img+");"}}]}}},{key:"selectedUserElement",value:function(e){var t=["dgfw-users-selected-user"];return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&t.push("invisible"),{tag:"div",id:"dgfw_criteria_users_"+this._id+"_selected_"+e.id,classes:t,attributes:{"data-decom-id":e.id},children:[{tag:"h4",classes:["dgfw-users-select-user-name"],text:e.displayName.length<30?e.displayName:e.displayName.slice(0,30)+"…"},{tag:"div",classes:["dgfw-users-select-user-img"],attributes:{style:"background-image: url("+e.img+");"}},{tag:"span",id:"dgfw_criteria_users_selected_remove_"+e.id,classes:["dgfw-users-selected-remove","dashicons-before","dashicons-no"],attributes:{"data-decom-id":e.id}}]}}},{key:"toggleSelectUser",value:function(e){this.hookElements();var t=jQuery(e.currentTarget),i=parseInt(t.data("decom-id"));t.toggleClass("selected"),this._value[i]?(delete this._value[i],this.removeFromList(i)):(this._value[i]=i,this.addToList(i)),this._$inputElement.val(Object.getOwnPropertyNames(this._value).join(","))}},{key:"removeSelectedUser",value:function(e){this.hookElements();var t=jQuery(e.currentTarget),i=parseInt(t.data("decom-id"));(t=jQuery("#dgfw_criteria_users_"+this._id+"_user_"+i)).removeClass("selected"),this._value[i]&&(delete this._value[i],this.removeFromList(i)),this._$inputElement.val(Object.getOwnPropertyNames(this._value).join(","))}},{key:"addToList",value:function(e){var t=this,i=this.user(e);this.createAndAppendChild(this._$selectedListElement,this.selectedUserElement(i)),setTimeout(function(){t._$selectedListElement.removeClass("invisible"),t.$userElement(e).removeClass("invisible"),setTimeout(function(){t.selectionChanged()},300)},50)}},{key:"removeFromList",value:function(e){var t=this,i=this.$userElement(e);i.addClass("invisible"),setTimeout(function(){0===Object.keys(t._value).length&&t._$selectedListElement.addClass("invisible"),i.remove(),setTimeout(function(){t.selectionChanged()},300)},50)}},{key:"selectionChangedEvent",value:function(){return"DGFW.SelectionChanged_"+this._id}},{key:"selectionChanged",value:function(){this._$inputElement.trigger(this.selectionChangedEvent())}},{key:"user",value:function(e){var t=!1;return decomGiftable.screen.data.users.forEach(function(i,s,n){i.id===e&&(t=i)}),t}},{key:"$userElement",value:function(e){return jQuery(document.getElementById("dgfw_criteria_users_"+this._id+"_selected_"+e))}},{key:"createAndAppendChild",value:function(e,t){var i=this,s=jQuery(document.createElement(t.tag));if(s.attr("id",t.id),t.classes&&s.addClass(t.classes.join(" ")),t.attributes)for(var n in t.attributes)s.attr(n,t.attributes[n]);return t.text&&s.text(t.text),e.append(s),t.children&&t.children.forEach(function(e,t,n){i.createAndAppendChild(s,e)}),s}},{key:"previousPage",value:function(){this.hookElements(),this._currentPage-=this._currentPage>0?1:0,this._$containerElement.find(".page-"+(this._currentPage+1)).removeClass("page-current"),this._$containerElement.find(".page-"+this._currentPage).removeClass("page-prev").addClass("page-current"),this.updateCurrentPageStatus()}},{key:"nextPage",value:function(){this.hookElements(),this._currentPage+=this._currentPage<this._totalPages-1?1:0,this._$containerElement.find(".page-"+(this._currentPage-1)).removeClass("page-current").addClass("page-prev"),this._$containerElement.find(".page-"+this._currentPage).addClass("page-current"),this.updateCurrentPageStatus()}},{key:"updateCurrentPageStatus",value:function(){this.hookElements(),this._$currentPageStatus.text(this._currentPage+1)}}]),o}(),b=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,d),t(a,[{key:"init",value:function(){this._type="users",this._sourceCriteria&&this.takeOverFromSource(),this._users=new y(this._id+"-users",{label:c.text("Users"),value:!!this._conditions.users&&this._conditions.users.value}),this._steps=new Array;var e=this._users.elements();this._steps[0]={description:c.text("Select users this gift category applies for."),help:c.text("This condition will be met if the customer is logged in as any of the selected users below."),elements:[{tag:"div",id:"dgfw_criteria_users_container_"+this._id,classes:["dgfw-criteria-input-container"],children:e}]},this.showCriteria(),this._bindings=this._bindings.concat(this._users.bindings()),this._bindings.push({selector:"#"+this._users.elementId(),event:this._users.selectionChangedEvent(),object:this,method:"readjustSize"}),i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}}]),a}(),w=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,l),t(a,[{key:"init",value:function(){var e=this;this._label=this._options.label,this._inputElementId="dgfw_criteria_roles_"+this._id,this._inputElementName="dgfw_criteria["+this._id.toString().split("-").join("][")+"][value]",this._value=this._options.value||new Array;var t=new Array;decomGiftable.screen.data.roles&&decomGiftable.screen.data.roles.forEach(function(i,s,n){t.push(e.roleElement(i))}),this._elements=[{tag:"div",id:"dgfw_select_roles_"+this._id,classes:["dgfw-checkbox-group-wrapper"],children:t}],i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}},{key:"roleElement",value:function(e){var t={type:"checkbox",name:this._inputElementName+"[]",value:e.name};return this._value.forEach(function(i,s,n){i===e.name&&(t.checked="checked")}),{tag:"div",id:"dgfw_criteria_roles_"+this._id+"_role_"+e.name,classes:["dgfw-roles-select"],attributes:{"data-decom-id":e.name},children:[{tag:"input",id:"dgfw_roles_select_"+this._id+"_checkbox_"+e.name,classes:["dgfw-roles-select-checkbox"],attributes:t},{tag:"label",classes:["dgfw-roles-select-label"],text:e.title,attributes:{for:"dgfw_roles_select_"+this._id+"_checkbox_"+e.name}}]}}}]),a}(),E=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,d),t(a,[{key:"init",value:function(){this._type="user_roles",this._sourceCriteria&&this.takeOverFromSource(),this._roles=new w(this._id+"-roles",{label:c.text("Roles"),value:!!this._conditions.roles&&this._conditions.roles.value}),this._steps=new Array,this._steps[0]={description:c.text("Select user roles this gift category applies for."),help:c.text("This condition will be met if the customer is a logged in user and has one of the user roles selected below."),elements:[{tag:"div",id:"dgfw_criteria_roles_container_"+this._id,classes:["dgfw-criteria-input-container"],children:this._roles.elements()}]},this.showCriteria(),this._bindings=this._bindings.concat(this._roles.bindings()),i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}}]),a}(),k=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,l),t(a,[{key:"init",value:function(){if(this._label=this._options.label,this._dateInputElementId="dgfw_criteria_date_"+this._id,this._timeInputElementId="dgfw_criteria_time_"+this._id,this._value=new Object,this._options.value)this._value=this._options.value;else{var e=new Date,t=new Object;t.dd=e.getDate(),t.mm=e.getMonth()+1,t.yyyy=e.getFullYear(),t.hh=e.getHours(),t.ii=e.getMinutes();for(var s in t)t[s]<10&&(t[s]="0"+t[s]);this._value.date=t.yyyy+"-"+t.mm+"-"+t.dd,this._value.time=t.hh+":"+t.ii}this._elements=[{tag:"label",id:"dgfw_criteria_date_label_"+this._id,classes:["dgfw-label-date"],text:this._label,attributes:{for:this._dateInputElementId}},{tag:"input",id:this._dateInputElementId,classes:["dgfw-date"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value][date]",type:"date",value:this._value.date}},{tag:"label",id:"dgfw_criteria_time_label_"+this._id,classes:["dgfw-label-time"],text:c.text(" at "),attributes:{for:this._timeInputElementId}},{tag:"input",id:this._timeInputElementId,classes:["dgfw-time"],attributes:{name:"dgfw_criteria["+this._id.toString().split("-").join("][")+"][value][time]",type:"time",value:this._value.time}}],i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}},{key:"hookElements",value:function(){this._$dateInputElement=this._$dateInputElement||jQuery(document.getElementById(this._dateInputElementId)),this._$timeInputElement=this._$timeInputElement||jQuery(document.getElementById(this._timeInputElementId))}},{key:"dateElementId",value:function(){return this._dateInputElementId}},{key:"timeElementId",value:function(){return this._timeInputElementId}},{key:"updateDate",value:function(){this.hookElements(),this._value.date=this._$dateInputElement.val()}},{key:"updateTime",value:function(){this.hookElements(),this._value.time=this._$timeInputElement.val()}}]),a}(),x=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,d),t(a,[{key:"init",value:function(){this._type="periods",this._sourceCriteria&&this.takeOverFromSource(),this._start=new k(this._id+"-start",{label:c.text("Start date"),value:!!this._conditions.start&&this._conditions.start.value}),this._end=new k(this._id+"-end",{label:c.text("End date"),value:!!this._conditions.end&&this._conditions.end.value}),this._steps=new Array,this._steps[0]={description:c.text("Set start and end of this period."),help:c.text("This condition will be met if the time of customer checkout is within the defined start/end time interval."),elements:[{tag:"div",id:"dgfw_criteria_periods_start_container_"+this._id,classes:["dgfw-criteria-input-container","dgfw-criteria-period-container"],children:this._start.elements()},{tag:"div",id:"dgfw_criteria_periods_end_container_"+this._id,classes:["dgfw-criteria-input-container","dgfw-criteria-period-container"],children:this._end.elements()}]},this.showCriteria(),this._bindings.push({selector:"#"+this._start.dateElementId(),event:"focusout",object:this,method:"updateStartDate"},{selector:"#"+this._start.timeElementId(),event:"focusout",object:this,method:"updateStartTime"},{selector:"#"+this._end.dateElementId(),event:"focusout",object:this,method:"updateEndDate"},{selector:"#"+this._end.timeElementId(),event:"focusout",object:this,method:"updateEndTime"}),i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}},{key:"updateStartDate",value:function(){this._start.updateDate()}},{key:"updateStartTime",value:function(){this._start.updateTime()}},{key:"updateEndDate",value:function(){this._end.updateDate()}},{key:"updateEndTime",value:function(){this._end.updateTime()}}]),a}(),C=new Map([["amounts",u],["items",p],["periods",x],["products",g],["product_categories",v],["users",b],["user_roles",E],["default",u]]),I=function(){function i(){e(this,i)}return t(i,null,[{key:"create",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return C.has(t)||(t="default"),new(C.get(t))(e,i)}},{key:"createAndScrollTo",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i.scrollTo=!0,this.create(e,t,i)}},{key:"createFrom",value:function(e,t){return C.has(t)||(t="default"),new(C.get(t))(e.id(),e.conditions(),e)}}]),i}(),$=function(){function i(t){var s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e(this,i),this._id=t.id,this._name=t.name,this._bound=new Array,this._$element=jQuery(document.getElementById(t.elementId)),this._$description=jQuery(document.getElementById(t.descriptionId)),this._$addButton=jQuery(document.getElementById(t.addButtonId)),this._criteria=new Map,s){var n=I.create(s.id,s.type,s);this._criteria.set(this._criteria.size.toString(),n),jQuery("#dgfw-loading").fadeOut(),this.updateDescription(),this.appendCriteriaElement(n.element()),this._bound.push(new a(this._$element,n.elementSelector(),n.changeTypeEvent(),this,"changeCriteriaType")),this._bound.push(new a(this._$element,n.elementSelector(),n.removeEvent(),this,"removeCriteria"))}}return t(i,[{key:"addCriteria",value:function(){var e=new u(this._criteria.size,{scrollTo:!0});this._criteria.set(this._criteria.size.toString(),e),this.updateDescription(),this._$addButton.hide(),this.appendCriteriaElement(e.element()),this._bound.push(new a(this._$element,e.elementSelector(),e.changeTypeEvent(),this,"changeCriteriaType")),this._bound.push(new a(this._$element,e.elementSelector(),e.removeEvent(),this,"removeCriteria"))}},{key:"removeCriteria",value:function(e,t){var i=this._criteria.get(t);this._criteria.delete(t),i.removeElement(),this.unbindSelector(i.elementSelector()),this.updateDescription(),this._$addButton.show()}},{key:"updateDescription",value:function(){this._$description.text("")}},{key:"appendCriteriaElement",value:function(e){this._$description.after(e)}},{key:"changeCriteriaType",value:function(e,t,i){var s=new I.createFrom(this._criteria.get(t),i);this._criteria.set(t,s)}},{key:"unbindSelector",value:function(e){var t=new Array;this._bound.forEach(function(i,s){i.selector()===e?i.unbind():t.push(i)}),this._bound=t}}]),i}(),S=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,o),t(a,[{key:"init",value:function(){this._category=new $(this._data.category,this._data.criteria),this._bindings.push({selector:"#dgfw_add_criteria",event:"click",object:this,method:"addCriteria"}),i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}},{key:"addCriteria",value:function(){this._category.addCriteria()}}]),a}(),j=function(r){function a(){return e(this,a),n(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return s(a,o),t(a,[{key:"init",value:function(){this._giftableOptionId="_dgfw_giftable",this._productTypeSelectId="product-type",this._hasGiftableVariationsId="_dgfw_has_giftable_variations",this._$giftableOption=jQuery(document.getElementById(this._giftableOptionId)),this._$producTypeSelect=jQuery(document.getElementById(this._productTypeSelectId)),this._$hasGiftableVariations=jQuery(document.getElementById(this._hasGiftableVariationsId)),this._bindings.push({selector:"#"+this._giftableOptionId,event:"change",object:this,method:"toggleGiftable"},{selector:"#"+this._productTypeSelectId,event:"change",object:this,method:"productTypeChange"},{selector:"#_virtual, #_downloadable",event:"change",object:this,method:"productTypeChange"},{selector:"input.variable_is_giftable",event:"change",object:this,method:"toggleGiftable"},{selector:"#woocommerce-product-data",event:"woocommerce_variations_loaded",object:this,method:"toggleGiftable"}),i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"init",this).call(this)}},{key:"toggleGiftable",value:function(){var e,t,i,s=!1;i=jQuery("input.variable_is_giftable");for(var n=0;n<i.length;n++){var r=jQuery(i[n]),a=r.closest(".woocommerce_variation").find(".dgfw_giftable_label");r.prop("checked")?(s=!0,this._$hasGiftableVariations.val("yes"),a.length||r.closest(".woocommerce_variation").find("h3").append(this.giftableVariationLabel())):a.remove()}i.length&&!s&&this._$hasGiftableVariations.val("no"),this._$giftableOption.prop("checked")||i.length&&s||"yes"===this._$hasGiftableVariations.val()?(e="show_if",t="hide_if"):(e="hide_if",t="show_if"),jQuery(document.getElementsByClassName(e+this._giftableOptionId)).show(),jQuery(document.getElementsByClassName(t+this._giftableOptionId)).hide(),this._$giftableOption.prop("checked")||"yes"!==this._$hasGiftableVariations.val()?jQuery(document.getElementsByClassName("show_if_has_giftable_variations_only")).hide():jQuery(document.getElementsByClassName("show_if_has_giftable_variations_only")).show()}},{key:"productTypeChange",value:function(){this._$giftableOption.is(":visible")&&this.toggleGiftable()}},{key:"giftableVariationLabel",value:function(){return'<strong class="dgfw_giftable_label">('+c.text("Giftable")+")</strong>"}}]),a}(),P=new Map([["edit-category",S],["edit-product",j]]),O=function(){function i(){e(this,i)}return t(i,null,[{key:"create",value:function(e){if(P.has(e.name))return new(P.get(e.name))(e.data)}}]),i}();new(function(){function i(){e(this,i),decomGiftable&&decomGiftable.screen&&(this._screen=O.create(decomGiftable.screen),this.init())}return t(i,[{key:"init",value:function(){r.info("Giftable for WooCommerce initialized.")}}]),i}())}();
